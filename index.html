<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangkok Explorer ğŸ‡¹ğŸ‡­</title>
    <style>
      @keyframes slideUp {
        from {
          transform: translateY(100px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
    </style>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            borderWidth: {
              '3': '3px',
              '4': '4px',
            }
          }
        }
      }
    </script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
const { useState, useEffect } = React;

// Google Places API Configuration
const GOOGLE_PLACES_API_KEY = 'AIzaSyD0F0TYKuWXVqibhj-sH-DaElDtLL8hMwM';
const GOOGLE_PLACES_API_URL = 'https://places.googleapis.com/v1/places:searchNearby';

const BangkokExplorer = () => {
  // Load saved preferences
  const loadPreferences = () => {
    try {
      const saved = localStorage.getItem('bangkok_preferences');
      if (saved) {
        const prefs = JSON.parse(saved);
        // Add maxStops if not present (for backward compatibility)
        if (!prefs.maxStops) prefs.maxStops = 10;
        // Add dataSource if not present (default: static for Claude debugging)
        if (!prefs.dataSource) prefs.dataSource = 'static';
        return prefs;
      }
    } catch (e) {}
    return {
      hours: 3,
      area: 'sukhumvit',
      interests: [],
      circular: true,
      startPoint: '',
      maxStops: 10,
      dataSource: 'static' // Default: static for Claude, change to 'dynamic' for production
    };
  };

  const [currentView, setCurrentView] = useState('form');
  const [formData, setFormData] = useState(loadPreferences());
  const [route, setRoute] = useState(null);
  const [isGenerating, setIsGenerating] = useState(false);
  const [disabledStops, setDisabledStops] = useState([]); // Track disabled stop IDs
  const [savedRoutes, setSavedRoutes] = useState([]);
  const [routeName, setRouteName] = useState('');
  const [showSaveDialog, setShowSaveDialog] = useState(false);
  const [customLocations, setCustomLocations] = useState([]);
  const [showAddLocationDialog, setShowAddLocationDialog] = useState(false);
  const [newLocation, setNewLocation] = useState({
    name: '',
    description: '',
    notes: '',
    area: formData.area,
    interests: [],
    lat: null,
    lng: null,
    mapsUrl: '',
    uploadedImage: null,  // Base64 image data
    imageUrls: []  // Array of URL strings
  });
  const [customInterests, setCustomInterests] = useState([]);
  const [showAddInterestDialog, setShowAddInterestDialog] = useState(false);
  const [newInterest, setNewInterest] = useState({ label: '', icon: 'ğŸ“', baseCategory: '' });
  const [showEditLocationDialog, setShowEditLocationDialog] = useState(false);
  const [editingLocation, setEditingLocation] = useState(null);
  const [showImageModal, setShowImageModal] = useState(false);
  const [modalImage, setModalImage] = useState(null);
  const [toastMessage, setToastMessage] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [searchResults, setSearchResults] = useState([]);
  const [showLocationDetailModal, setShowLocationDetailModal] = useState(false);
  const [selectedLocation, setSelectedLocation] = useState(null);
  const [showImportDialog, setShowImportDialog] = useState(false);
  const [importedData, setImportedData] = useState(null);

  // Toast notification helper
  const showToast = (message, type = 'success') => {
    setToastMessage({ message, type });
    setTimeout(() => setToastMessage(null), 4000); // Hide after 4 seconds
  };

  // Load saved routes, custom locations, and custom interests from localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('bangkok_saved_routes');
      if (saved) {
        setSavedRoutes(JSON.parse(saved));
      }
      const customLocs = localStorage.getItem('bangkok_custom_locations');
      if (customLocs) {
        setCustomLocations(JSON.parse(customLocs));
      }
      const customInts = localStorage.getItem('bangkok_custom_interests');
      if (customInts) {
        setCustomInterests(JSON.parse(customInts));
      }
    } catch (e) {
      // Silent fail
    }
  }, []);

  const interestOptions = [
    { id: 'temples', label: '××§×“×©×™×', icon: 'ğŸ›•' },
    { id: 'food', label: '××•×›×œ', icon: 'ğŸœ' },
    { id: 'graffiti', label: '×’×¨×¤×™×˜×™', icon: 'ğŸ¨' },
    { id: 'artisans', label: '××œ××›×”', icon: 'ğŸ”¨' },
    { id: 'galleries', label: '×’×œ×¨×™×•×ª', icon: 'ğŸ–¼ï¸' },
    { id: 'architecture', label: '××¨×›×™×˜×§×˜×•×¨×”', icon: 'ğŸ›ï¸' },
    { id: 'canals', label: '×ª×¢×œ×•×ª', icon: 'ğŸš¤' },
    { id: 'cafes', label: '×§×¤×”', icon: 'â˜•' },
    { id: 'markets', label: '×©×•×•×§×™×', icon: 'ğŸª' },
    { id: 'nightlife', label: '×œ×™×œ×”', icon: 'ğŸŒƒ' },
    { id: 'parks', label: '×¤××¨×§×™×', icon: 'ğŸŒ³' },
    { id: 'rooftop', label: '×’×’×•×ª', icon: 'ğŸŒ†' },
    { id: 'entertainment', label: '×‘×™×“×•×¨', icon: 'ğŸ­' },
    { id: 'other', label: '××—×¨', icon: 'ğŸ“' }
  ];

  // Map our interests to Google Places categories
  const interestToGooglePlaces = {
    temples: ['hindu_temple', 'church', 'mosque', 'synagogue'],
    food: ['restaurant', 'meal_takeaway'],
    graffiti: ['tourist_attraction', 'art_gallery'],
    artisans: ['store', 'art_gallery'],
    galleries: ['art_gallery', 'museum'],
    architecture: ['tourist_attraction', 'historical_landmark'],
    canals: ['tourist_attraction'],
    cafes: ['cafe', 'coffee_shop'],
    markets: ['market', 'shopping_mall'],
    nightlife: ['bar', 'night_club'],
    parks: ['park', 'national_park'],
    rooftop: ['bar', 'restaurant'],
    entertainment: ['movie_theater', 'amusement_park', 'tourist_attraction'],
    other: ['tourist_attraction']
  };

  // Interests NOT covered by the system - for informational purposes in settings
  const uncoveredInterests = [
    { icon: 'ğŸ’†', name: '×¢×™×¡×•×™ ×•×¡×¤×', examples: 'Thai massage, wellness centers, spa' },
    { icon: 'ğŸ‹ï¸', name: '×›×•×©×¨ ×•×¡×¤×•×¨×˜', examples: 'Gyms, yoga studios, Muay Thai, fitness' },
    { icon: 'ğŸ›ï¸', name: '×§× ×™×•×ª ××™×•×—×“×•×ª', examples: 'Boutiques, jewelry, fashion stores' },
    { icon: 'ğŸ“', name: '×œ×™××•×“ ×•×—×•×•×™×•×ª', examples: 'Cooking classes, meditation, workshops' },
    { icon: 'ğŸ¥', name: '×‘×¨×™××•×ª ×•×¨×¤×•××”', examples: 'Clinics, pharmacies, health services' },
    { icon: 'ğŸ¨', name: '××™×¨×•×—', examples: 'Hotels, hostels, guesthouses' },
    { icon: 'ğŸš—', name: '×ª×—×‘×•×¨×”', examples: 'Car rental, bike rental, transportation' },
    { icon: 'ğŸ’¼', name: '×¢×¡×§×™×', examples: 'Coworking, offices, business centers' }
  ];

  // Tooltip content - simple explanations for each interest
  const interestTooltips = {
    temples: '××§×“×©×™× ×‘×•×“×”×™×¡×˜×™×™× ×•×”×™× ×“×™×™×',
    food: '××¡×¢×“×•×ª ×•××•×›×œ ×¨×—×•×‘',
    graffiti: '××•×× ×•×ª ×¨×—×•×‘ ×•×’×¨×¤×™×˜×™',
    artisans: '×‘×ª×™ ××œ××›×” ×•××•×× ×™×',
    galleries: '×’×œ×¨×™×•×ª ×•××•×–×™××•× ×™×',
    architecture: '×‘× ×™×™× ×™× ×”×™×¡×˜×•×¨×™×™×',
    canals: '×©×™×™×˜×™× ×‘×ª×¢×œ×•×ª ×•×‘× ×”×¨',
    cafes: '×‘×ª×™ ×§×¤×”',
    markets: '×©×•×•×§×™× ×•×‘×–××¨×™×',
    nightlife: '×‘×¨×™× ×•××•×¢×“×•× ×™ ×œ×™×œ×”',
    parks: '×’× ×™× ×•×¤××¨×§×™×',
    rooftop: '×‘×¨×™× ×•××¡×¢×“×•×ª ×¢×œ ×’×’×•×ª',
    entertainment: '×§×•×œ× ×•×¢, ×ª×™××˜×¨×•×Ÿ, ××•×¤×¢×™×',
    other: '××§×•××•×ª × ×•×¡×¤×™×'
  };

  // Area coordinates (center points)
  const areaCoordinates = {
    'sukhumvit': { lat: 13.7370, lng: 100.5610, radius: 2500 }, // 2.5km radius
    'old-town': { lat: 13.7500, lng: 100.4914, radius: 2000 },
    'chinatown': { lat: 13.7408, lng: 100.5050, radius: 1500 },
    'thonglor': { lat: 13.7320, lng: 100.5830, radius: 2000 },
    'ari': { lat: 13.7790, lng: 100.5410, radius: 2000 },
    'riverside': { lat: 13.7270, lng: 100.4965, radius: 2000 }
  };
  
  // Check if location is within area boundaries
  const checkLocationInArea = (lat, lng, areaId) => {
    const area = areaCoordinates[areaId];
    if (!area || !lat || !lng) return { valid: true, distance: 0 };
    
    // Calculate distance using Haversine formula
    const R = 6371e3; // Earth radius in meters
    const lat1Rad = lat * Math.PI / 180;
    const lat2Rad = area.lat * Math.PI / 180;
    const deltaLat = (area.lat - lat) * Math.PI / 180;
    const deltaLng = (area.lng - lng) * Math.PI / 180;
    
    const a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) +
              Math.cos(lat1Rad) * Math.cos(lat2Rad) *
              Math.sin(deltaLng/2) * Math.sin(deltaLng/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    const distance = R * c; // Distance in meters
    
    const isValid = distance <= area.radius;
    
    return { 
      valid: isValid, 
      distance: Math.round(distance),
      distanceKm: (distance / 1000).toFixed(1)
    };
  };

  // Fetch places from Google Places API
  const fetchGooglePlaces = async (area, interests) => {
    const center = areaCoordinates[area];
    if (!center) {
      console.error('[DYNAMIC] No coordinates for area:', area);
      return [];
    }

    try {
      console.log('[DYNAMIC] Fetching from Google Places API:', { area, interests });
      
      // Get all relevant place types
      const placeTypes = [...new Set(
        interests.flatMap(interest => {
          const customInterest = customInterests.find(ci => ci.id === interest);
          const baseInterest = customInterest?.baseCategory || interest;
          return interestToGooglePlaces[baseInterest] || ['point_of_interest'];
        })
      )];

      const response = await fetch(GOOGLE_PLACES_API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Goog-Api-Key': GOOGLE_PLACES_API_KEY,
          'X-Goog-FieldMask': 'places.displayName,places.formattedAddress,places.location,places.rating,places.userRatingCount,places.types'
        },
        body: JSON.stringify({
          includedTypes: placeTypes.slice(0, 10), // API limit
          maxResultCount: 20,
          locationRestriction: {
            circle: {
              center: {
                latitude: center.lat,
                longitude: center.lng
              },
              radius: 2000 // 2km radius
            }
          },
          rankPreference: 'POPULARITY'
        })
      });

      console.log('[DYNAMIC] Google Places Response:', { 
        status: response.status, 
        ok: response.ok,
        statusText: response.statusText
      });

      if (!response.ok) {
        const errorText = await response.text();
        console.error('[DYNAMIC] Error fetching Google Places:', {
          status: response.status,
          statusText: response.statusText,
          error: errorText,
          area,
          interests,
          placeTypes
        });
        throw new Error(`Google API Error ${response.status}: ${errorText}`);
      }

      const data = await response.json();
      
      console.log('[DYNAMIC] Google Places Response:', {
        area,
        interests,
        placeTypes,
        foundPlaces: data.places?.length || 0
      });
      
      if (!data.places) {
        console.warn('[DYNAMIC] No places found in response');
        return [];
      }

      // Filter and transform Google Places data
      let filteredCount = 0;
      let ratingFilteredCount = 0;
      let typeFilteredCount = 0;
      
      const transformed = data.places
        .filter(place => {
          // Filter 1: Rating check
          if (place.rating < 4.0) {
            ratingFilteredCount++;
            return false;
          }
          
          // Filter 2: Type validation - CRITICAL!
          // Only include places that have at least one of the types we requested
          const placeTypesFromGoogle = place.types || [];
          const hasValidType = placeTypesFromGoogle.some(type => placeTypes.includes(type));
          
          if (!hasValidType) {
            typeFilteredCount++;
            console.log('[DYNAMIC] âŒ Filtered out (invalid type):', {
              name: place.displayName?.text,
              googleTypes: placeTypesFromGoogle,
              expectedTypes: placeTypes
            });
            return false;
          }
          
          console.log('[DYNAMIC] âœ… Kept:', {
            name: place.displayName?.text,
            matchingTypes: placeTypesFromGoogle.filter(t => placeTypes.includes(t))
          });
          
          return true;
        })
        .map((place, index) => ({
          name: place.displayName?.text || 'Unknown Place',
          lat: place.location?.latitude || center.lat,
          lng: place.location?.longitude || center.lng,
          description: `â­ ${place.rating?.toFixed(1) || 'N/A'} (${place.userRatingCount || 0} ×‘×™×§×•×¨×•×ª)`,
          duration: 45,
          googlePlace: true,
          rating: place.rating || 0,
          ratingCount: place.userRatingCount || 0
        }));
      
      console.log('[DYNAMIC] Filtering summary:', {
        received: data.places.length,
        ratingFiltered: ratingFilteredCount,
        typeFiltered: typeFilteredCount,
        final: transformed.length
      });
      
      return transformed;
    } catch (error) {
      console.error('[DYNAMIC] Error fetching Google Places:', {
        error: error.message,
        stack: error.stack,
        area,
        interests
      });
      
      // Throw error to be handled by caller
      throw {
        type: 'GOOGLE_API_ERROR',
        message: error.message,
        details: { area, interests, stack: error.stack }
      };
    }
  };

  // Combine default and custom interests - with safety check
  const allInterestOptions = [...interestOptions, ...(customInterests || [])];

  // Save preferences whenever they change
  useEffect(() => {
    localStorage.setItem('bangkok_preferences', JSON.stringify(formData));
  }, [formData]);

  const areaOptions = [
    { id: 'sukhumvit', label: '×¡×•×§×•××•×•×™×ª', labelEn: 'Sukhumvit', icon: 'ğŸ™ï¸' },
    { id: 'old-town', label: '×”×¢×™×¨ ×”×¢×ª×™×§×”', labelEn: 'Old Town', icon: 'ğŸ°' },
    { id: 'chinatown', label: '×¦\'×™×™× ×” ×˜××•×Ÿ', labelEn: 'Chinatown', icon: 'ğŸ®' },
    { id: 'thonglor', label: '×ª×•× ×’×œ×•×¨', labelEn: 'Thonglor', icon: 'â˜•' },
    { id: 'ari', label: '××¨×™', labelEn: 'Ari', icon: 'ğŸ¨' },
    { id: 'riverside', label: '×¨×™×‘×¨×¡×™×™×“', labelEn: 'Riverside', icon: 'ğŸŒŠ' }
  ];


  // ============================================================================
  // STATIC DATA MANAGER - Separate component for static curated locations
  // Used when dataSource === 'static' (for debugging in Claude Artifacts)
  // ============================================================================
  
  const StaticDataManager = (() => {
  const staticLocationsData = {
    sukhumvit: {
      // Sukhumvit: ××–×•×¨ Asok, Nana, Phrom Phong
      graffiti: [
        { name: 'Sukhumvit Soi 11 Street Art', lat: 13.7450, lng: 100.5535, description: '×’×¨×¤×™×˜×™ ×•×‘×™×œ×•×™', duration: 25 },
        { name: 'Phrom Phong Art Walk', lat: 13.7305, lng: 100.5700, description: '××•×× ×•×ª ×¨×—×•×‘ ×œ×™×“ BTS', duration: 30 },
        { name: 'Soi 23 Graffiti Wall', lat: 13.7410, lng: 100.5640, description: '×§×™×¨ ×’×¨×¤×™×˜×™', duration: 25 }
      ],
      galleries: [
        { name: 'H Gallery', lat: 13.7290, lng: 100.5715, description: '×’×œ×¨×™×” ×¢×›×©×•×•×™×ª', duration: 45 },
        { name: 'Number 1 Gallery', lat: 13.7420, lng: 100.5565, description: '××•×× ×•×ª ××§×•××™×ª', duration: 30 },
        { name: 'Thavibu Gallery', lat: 13.7365, lng: 100.5625, description: '××•×× ×•×ª ××¡×™××ª×™×ª', duration: 40 }
      ],
      artisans: [
        { name: 'Jim Thompson House', lat: 13.7464, lng: 100.5347, description: '×‘×™×ª ××©×™ ×•××“×¨×™×›×œ×•×ª', duration: 60 },
        { name: 'Local Crafts Soi 33', lat: 13.7355, lng: 100.5680, description: '××œ××›×” ×ª××™×œ× ×“×™×ª', duration: 40 }
      ],
      cafes: [
        { name: 'Rocket Coffeebar Soi 12', lat: 13.7425, lng: 100.5575, description: '×§×¤×” ××™× ×™××œ×™×¡×˜×™', duration: 40 },
        { name: 'Roast Coffee Asok', lat: 13.7375, lng: 100.5605, description: '×§×¤×” ××™×›×•×ª×™ ×œ×™×“ BTS', duration: 35 },
        { name: 'Roots Coffee Soi 49', lat: 13.7295, lng: 100.5760, description: '×§×¤×” ×‘×•×˜×™×§', duration: 30 },
        { name: 'EmQuartier Cafes', lat: 13.7310, lng: 100.5695, description: '×§×¤×” ×‘×§× ×™×•×Ÿ ××•×“×¨× ×™', duration: 40 }
      ],
      architecture: [
        { name: 'Terminal 21 Asoke', lat: 13.7380, lng: 100.5600, description: '×§× ×™×•×Ÿ ×‘×¢×™×¦×•×‘ ×¢×¨×™×', duration: 60 },
        { name: 'EmQuartier Mall', lat: 13.7310, lng: 100.5695, description: '×§× ×™×•×Ÿ ××•×“×¨× ×™ ×™×•×§×¨×ª×™', duration: 50 },
        { name: 'Benjakitti Park', lat: 13.7300, lng: 100.5645, description: '×¤××¨×§ ×•××’× ×’×“×•×œ', duration: 45 },
        { name: 'Jim Thompson House', lat: 13.7464, lng: 100.5347, description: '×‘×™×ª ××©×™ ×”×™×¡×˜×•×¨×™', duration: 60 }
      ],
      food: [
        { name: 'Sukhumvit Soi 38 Night Market', lat: 13.7345, lng: 100.5725, description: '×©×•×§ ××•×›×œ ×¨×—×•×‘ ××¤×•×¨×¡×', duration: 60 },
        { name: 'Terminal 21 Food Court', lat: 13.7380, lng: 100.5600, description: '××ª×—× ××•×›×œ ×‘×§× ×™×•×Ÿ', duration: 45 },
        { name: 'Nana Plaza Restaurants', lat: 13.7415, lng: 100.5550, description: '××¡×¢×“×•×ª ××’×•×•× ×•×ª', duration: 50 }
      ],
      markets: [
        { name: 'Khlong Toei Market', lat: 13.7230, lng: 100.5840, description: '×©×•×§ ×¡×™×˜×•× ××™ ×•××•×›×œ', duration: 50 },
        { name: 'Sukhumvit Plaza Market', lat: 13.7390, lng: 100.5585, description: '×©×•×§ ××§×•××™', duration: 40 },
        { name: 'Terminal 21 Shopping', lat: 13.7380, lng: 100.5600, description: '×§× ×™×•×Ÿ ×¢× ×©×•×•×§×™×', duration: 50 },
        { name: 'Sukhumvit Soi 38 Night Market', lat: 13.7345, lng: 100.5725, description: '×©×•×§ ××•×›×œ ×•××•×¦×¨×™×', duration: 60 }
      ],
      nightlife: [
        { name: 'Sukhumvit Soi 11 Bars', lat: 13.7450, lng: 100.5535, description: '×¨×—×•×‘ ×‘×¨×™× ×•××•×¢×“×•× ×™×', duration: 90 },
        { name: 'Nana Plaza Entertainment', lat: 13.7415, lng: 100.5550, description: '××–×•×¨ ×‘×™×œ×•×™ ×•××¡×¢×“×•×ª', duration: 90 },
        { name: 'Asok Nightlife Area', lat: 13.7370, lng: 100.5610, description: '×‘×™×œ×•×™ ×œ×™×“ BTS', duration: 80 }
      ],
      parks: [
        { name: 'Benjakitti Park', lat: 13.7300, lng: 100.5645, description: '×¤××¨×§ ×¢×™×¨×•× ×™ ×’×“×•×œ', duration: 45 }
      ],
      entertainment: [
        { name: 'Terminal 21 Cineplex', lat: 13.7380, lng: 100.5600, description: '×§×•×œ× ×•×¢ ×‘×§× ×™×•×Ÿ', duration: 150 },
        { name: 'EmQuartier Cineplex', lat: 13.7310, lng: 100.5695, description: '×§×•×œ× ×•×¢ ×™×•×§×¨×ª×™', duration: 150 },
        { name: 'Saxophone Pub & Restaurant', lat: 13.7405, lng: 100.5545, description: '××•×¢×“×•×Ÿ ×’\'××– ×—×™', duration: 120 },
        { name: 'Escape Hunt Bangkok', lat: 13.7310, lng: 100.5695, description: '×—×“×¨ ×‘×¨×™×—×”', duration: 90 }
      ]
    },
    'old-town': {
      // Old Town: Rattanakosin - ×”××¨××•×Ÿ, ×•××˜ ×¤×•, ×§××•×¡××Ÿ
      temples: [
        { name: 'Wat Pho', lat: 13.7465, lng: 100.4927, description: '×‘×•×“×”×” ×”×©×•×›×‘', duration: 90 },
        { name: 'Grand Palace', lat: 13.7500, lng: 100.4914, description: '×”××¨××•×Ÿ ×”××œ×›×•×ª×™', duration: 120 },
        { name: 'Wat Saket (Golden Mount)', lat: 13.7539, lng: 100.5064, description: '×”×¨ ×”×–×”×‘', duration: 60 },
        { name: 'Wat Suthat', lat: 13.7513, lng: 100.5006, description: '××§×“×© ×’×“×•×œ', duration: 45 }
      ],
      architecture: [
        { name: 'Wat Arun', lat: 13.7437, lng: 100.4888, description: '××§×“×© ×”×©×—×¨', duration: 60 },
        { name: 'Democracy Monument', lat: 13.7566, lng: 100.5015, description: '×× ×“×¨×˜×ª ×“××•×§×¨×˜×™×”', duration: 20 },
        { name: 'Giant Swing', lat: 13.7512, lng: 100.5014, description: '× ×“× ×“×” ×¢× ×§×™×ª', duration: 15 }
      ],
      canals: [
        { name: 'Khlong Saen Saeb Canal Boat', lat: 13.7590, lng: 100.5017, description: '×¡×™×¨×ª ×ª×¢×œ×”', duration: 30 },
        { name: 'Longtail Boat Tour', lat: 13.7520, lng: 100.4950, description: '×¡×™×•×¨ ×‘×ª×¢×œ×•×ª', duration: 90 }
      ],
      markets: [
        { name: 'Pak Khlong Talat', lat: 13.7413, lng: 100.4959, description: '×©×•×§ ×¤×¨×—×™× 24 ×©×¢×•×ª', duration: 45 },
        { name: 'Amulet Market', lat: 13.7480, lng: 100.4938, description: '×©×•×§ ×§××™×¢×•×ª', duration: 30 }
      ],
      food: [
        { name: 'Khao San Road', lat: 13.7590, lng: 100.4978, description: '×¨×—×•×‘ ×ª×¨××™×œ××™×', duration: 90 },
        { name: 'Tha Tien Market', lat: 13.7450, lng: 100.4920, description: '×©×•×§ ××•×›×œ ××§×•××™', duration: 40 }
      ],
      entertainment: [
        { name: 'National Theatre', lat: 13.7540, lng: 100.5025, description: '×ª×™××˜×¨×•×Ÿ ×œ××•××™ - ××•×¤×¢×™× ×ª××™×œ× ×“×™×™×', duration: 120 },
        { name: 'Rattanakosin Exhibition Hall', lat: 13.7513, lng: 100.4988, description: '××•×œ× ×ª×¢×¨×•×›×•×ª', duration: 60 }
      ]
    },
    chinatown: {
      // Chinatown: Yaowarat, Sampeng
      food: [
        { name: 'Yaowarat Road', lat: 13.7408, lng: 100.5133, description: '×¨×—×•×‘ ×”××•×›×œ ×”××¤×•×¨×¡×', duration: 90 },
        { name: 'T&K Seafood', lat: 13.7392, lng: 100.5078, description: '×¤×™×¨×•×ª ×™× ××¤×•×¨×¡×', duration: 60 },
        { name: 'Nai Ek Roll Noodles', lat: 13.7420, lng: 100.5110, description: '× ×•×“×œ×¡ ×’×œ×™×œ×”', duration: 30 },
        { name: 'Chinatown Odeon Circle', lat: 13.7403, lng: 100.5152, description: '××¢×’×œ ××•×›×œ', duration: 50 }
      ],
      markets: [
        { name: 'Sampeng Lane', lat: 13.7422, lng: 100.5102, description: '×¡××˜×ª ×¡×™×˜×•× ××•×ª', duration: 60 },
        { name: 'Yaowarat Market', lat: 13.7405, lng: 100.5115, description: '×©×•×§ ×¡×™× ×™', duration: 50 },
        { name: 'Nakhon Kasem (Thieves Market)', lat: 13.7445, lng: 100.5098, description: '×©×•×§ ×’× ×‘×™×', duration: 45 }
      ],
      temples: [
        { name: 'Wat Traimit', lat: 13.7403, lng: 100.5152, description: '×‘×•×“×”×” ×–×”×‘ 5.5 ×˜×•×Ÿ', duration: 45 },
        { name: 'Wat Mangkon Kamalawat', lat: 13.7431, lng: 100.5123, description: '××§×“×© ×¡×™× ×™ ×¢×ª×™×§', duration: 40 }
      ],
      architecture: [
        { name: 'Yaowarat Chinatown Gate', lat: 13.7403, lng: 100.5152, description: '×©×¢×¨ ×¦\'×™×™× ×” ×˜××•×Ÿ', duration: 15 },
        { name: 'Old Shophouses', lat: 13.7410, lng: 100.5120, description: '×‘×ª×™ ×—× ×•×ª ×¢×ª×™×§×™×', duration: 30 }
      ],
      entertainment: [
        { name: 'Chinatown Heritage Center', lat: 13.7422, lng: 100.5102, description: '××¨×›×– ××•×¨×©×ª', duration: 60 }
      ]
    },
    thonglor: {
      // Thonglor/Ekkamai: Sukhumvit Soi 55 area
      galleries: [
        { name: 'ARDEL Gallery', lat: 13.7284, lng: 100.5801, description: '××•×× ×•×ª ×¢×›×©×•×•×™×ª', duration: 50 },
        { name: '100 Tonson Gallery', lat: 13.7326, lng: 100.5795, description: '×’×œ×¨×™×” ×‘×•×˜×™×§', duration: 40 },
        { name: 'Bangkok CityCity Gallery', lat: 13.7312, lng: 100.5789, description: '××•×× ×•×ª ××§×•××™×ª', duration: 45 }
      ],
      cafes: [
        { name: 'Casa Lapin x49', lat: 13.7325, lng: 100.5814, description: '×§×¤×” ×™×¤× ×™-×¡×§× ×“×™× ×‘×™', duration: 50 },
        { name: 'Everyday Karmakamet', lat: 13.7312, lng: 100.5797, description: '×§×¤×” ×•×‘×©××™×', duration: 45 },
        { name: 'Roots Coffee Roaster', lat: 13.7329, lng: 100.5821, description: '×§×¤×” ××§×•××™', duration: 40 },
        { name: 'Ceresia Coffee', lat: 13.7318, lng: 100.5805, description: '×§×¤×” ××™×›×•×ª×™', duration: 35 }
      ],
      food: [
        { name: 'Thonglor Soi 13', lat: 13.7323, lng: 100.5795, description: '××¡×¢×“×•×ª ×‘×•×˜×™×§', duration: 60 },
        { name: 'J Avenue Food Hall', lat: 13.7315, lng: 100.5806, description: '××ª×—× ××•×›×œ', duration: 50 }
      ],
      nightlife: [
        { name: 'Thonglor Soi 10', lat: 13.7318, lng: 100.5810, description: '×‘×¨×™× ×•××•×¢×“×•× ×™×', duration: 90 },
        { name: 'Arena 10', lat: 13.7320, lng: 100.5812, description: '××•×¢×“×•×Ÿ', duration: 80 }
      ],
      markets: [
        { name: 'W Market Ekkamai', lat: 13.7206, lng: 100.5891, description: '×©×•×§ ×œ×™×œ×” ×•×™× ×˜×’\'', duration: 60 }
      ],
      entertainment: [
        { name: 'Major Cineplex Ekkamai', lat: 13.7195, lng: 100.5850, description: '×§×•×œ× ×•×¢ ×’×“×•×œ', duration: 150 },
        { name: 'The Commons Jazz Bar', lat: 13.7300, lng: 100.5743, description: '×‘×¨ ×’\'××– ××™× ×˜×™××™', duration: 120 }
      ]
    },
    ari: {
      // Ari: BTS Ari area, Phahonyothin Soi 7
      graffiti: [
        { name: 'Ari Street Art', lat: 13.7788, lng: 100.5445, description: '×’×¨×¤×™×˜×™ ×‘×¡××˜××•×ª', duration: 30 }
      ],
      galleries: [
        { name: 'Speedy Grandma', lat: 13.7774, lng: 100.5423, description: '×’×œ×¨×™×” ×§×˜× ×”', duration: 35 },
        { name: 'The Reading Room', lat: 13.7780, lng: 100.5435, description: '×¡×¤×¨×™×™×” ×•×’×œ×¨×™×”', duration: 40 }
      ],
      cafes: [
        { name: 'Audrey Cafe', lat: 13.7781, lng: 100.5419, description: '×§×¤×” ×•×¨×•×“ ××•×“×¨×™ ×”×¤×‘×•×¨×Ÿ', duration: 50 },
        { name: 'Macaroni Club', lat: 13.7803, lng: 100.5461, description: '×§×¤×” ××™×˜×œ×§×™ ×¨×˜×¨×•', duration: 60 },
        { name: 'Brave Roasters', lat: 13.7795, lng: 100.5441, description: '×§×¤×” ××§×•××™ ××™×›×•×ª×™', duration: 40 },
        { name: 'Stendhal Syndrome', lat: 13.7785, lng: 100.5430, description: '×§×¤×” ××× ×•×ª×™', duration: 45 }
      ],
      artisans: [
        { name: 'YELO House', lat: 13.7792, lng: 100.5432, description: '×‘×™×ª ×‘×¢×œ×™ ××œ××›×”', duration: 45 },
        { name: 'Play Pot', lat: 13.7787, lng: 100.5438, description: '×§×¨××™×§×”', duration: 50 }
      ],
      food: [
        { name: 'Ari Night Market', lat: 13.7785, lng: 100.5437, description: '×©×•×§ ××•×›×œ ×œ×™×œ×”', duration: 60 },
        { name: 'Ari Soi 1', lat: 13.7790, lng: 100.5440, description: '××¡×¢×“×•×ª', duration: 50 }
      ],
      parks: [
        { name: 'Chatuchak Park', lat: 13.8034, lng: 100.5523, description: '×¤××¨×§ ×’×“×•×œ', duration: 40 }
      ],
      entertainment: [
        { name: 'Iron Fairies Bar', lat: 13.7790, lng: 100.5445, description: '×‘×¨ ××œ×˜×¨× ×˜×™×‘×™', duration: 90 }
      ]
    },
    riverside: {
      // Riverside: ×œ××•×¨×š × ×”×¨ Chao Phraya
      canals: [
        { name: 'Chao Phraya River Cruise', lat: 13.7248, lng: 100.5084, description: '×©×™×™×˜ ××¨×•×—×ª ×¢×¨×‘', duration: 120 },
        { name: 'Chao Phraya Express Boat', lat: 13.7272, lng: 100.5085, description: '×¡×™×¨×ª ×ª×—×‘×•×¨×”', duration: 30 },
        { name: 'Khlong Bangkok Yai Tour', lat: 13.7380, lng: 100.4895, description: '×ª×¢×œ×” ×’×“×•×œ×”', duration: 60 }
      ],
      rooftop: [
        { name: 'Sky Bar Lebua', lat: 13.7227, lng: 100.5089, description: '×‘×¨ ×’×’ Hangover 2', duration: 90 },
        { name: 'Above Eleven', lat: 13.7245, lng: 100.5256, description: '×‘×¨ ×’×’ ×¤×¨×•×× ×™', duration: 80 },
        { name: 'The Deck by Arun Residence', lat: 13.7430, lng: 100.4895, description: '××¡×¢×“×ª ×’×’ ××•×œ Wat Arun', duration: 70 }
      ],
      architecture: [
        { name: 'Asiatique Riverfront', lat: 13.7051, lng: 100.5091, description: '×©×•×§ ×¨×™×‘×¨×¡×™×™×“ ×¢× ×§', duration: 120 },
        { name: 'Mandarin Oriental', lat: 13.7237, lng: 100.5145, description: '××œ×•×Ÿ ×”×™×¡×˜×•×¨×™ 1876', duration: 30 },
        { name: 'ICONSIAM', lat: 13.7268, lng: 100.5101, description: '×§× ×™×•×Ÿ ×¢×œ ×”× ×”×¨', duration: 90 },
        { name: 'Warehouse 30', lat: 13.7305, lng: 100.5024, description: '××—×¡×Ÿ ××•×× ×•×ª Talat Noi', duration: 50 }
      ],
      temples: [
        { name: 'Wat Arun from River', lat: 13.7437, lng: 100.4888, description: '××§×“×© ×”×©×—×¨ ××”× ×”×¨', duration: 60 },
        { name: 'Wat Kalayanamit', lat: 13.7351, lng: 100.4900, description: '××§×“×© ×¢×œ ×”× ×”×¨', duration: 40 }
      ],
      graffiti: [
        { name: 'Talat Noi Street Art', lat: 13.7305, lng: 100.5024, description: '××•×× ×•×ª ×¨×—×•×‘ ×‘×©×›×•× ×” ×¡×™× ×™×ª', duration: 40 }
      ],
      entertainment: [
        { name: 'Asiatique Sky Theater', lat: 13.7045, lng: 100.5076, description: '×ª×™××˜×¨×•×Ÿ ××•×¤×¢×™×', duration: 90 },
        { name: 'Calypso Cabaret', lat: 13.7048, lng: 100.5078, description: '××•×¤×¢ ×§×‘×¨×˜', duration: 90 },
        { name: 'ICONSIAM ICON Cineplex', lat: 13.7268, lng: 100.5101, description: '×§×•×œ× ×•×¢ ×¢×œ ×”× ×”×¨', duration: 150 }
      ]
    }
  };
    
    // Public API for StaticDataManager
    return {
      // Get locations for specific area and interests
      getLocations: (area, interests) => {
        console.log('[STATIC] Getting locations:', { area, interests });
        const areaData = staticLocationsData[area] || staticLocationsData.sukhumvit;
        let stops = [];
        
        interests.forEach(interest => {
          // Skip custom interests (they start with 'custom_')
          if (interest.startsWith('custom_')) {
            console.log('[STATIC] Skipping custom interest:', interest);
            return;
          }
          
          if (areaData[interest]) {
            stops = [...stops, ...areaData[interest]];
          } else {
            console.log('[STATIC] No data for interest:', interest);
          }
        });
        
        // Remove duplicates
        const seen = new Set();
        const unique = stops.filter(stop => {
          const key = `${stop.lat},${stop.lng}`;
          if (seen.has(key)) return false;
          seen.add(key);
          return true;
        });
        
        console.log('[STATIC] Found places:', unique.length);
        return unique;
      },
      
      // Check if static data is available
      hasData: () => {
        return Object.keys(staticLocationsData).length > 0;
      },
      
      // Get all areas
      getAreas: () => {
        return Object.keys(staticLocationsData);
      }
    };
  })();

  const allLocations = {
    sukhumvit: {},
    'old-town': {},
    chinatown: {},
    thonglor: {},
    ari: {},
    riverside: {}
  };


  // ============================================================================
  // IMAGE HANDLING - Compression and utilities
  // ============================================================================
  
  const compressImage = (file, maxSizeKB = 200) => {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          let width = img.width;
          let height = img.height;
          
          // Calculate new dimensions to keep under maxSizeKB
          const maxDimension = 800;
          if (width > height && width > maxDimension) {
            height = (height / width) * maxDimension;
            width = maxDimension;
          } else if (height > maxDimension) {
            width = (width / height) * maxDimension;
            height = maxDimension;
          }
          
          canvas.width = width;
          canvas.height = height;
          
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, width, height);
          
          // Start with quality 0.8 and reduce if needed
          let quality = 0.8;
          let compressed = canvas.toDataURL('image/jpeg', quality);
          
          // If still too large, reduce quality
          while (compressed.length > maxSizeKB * 1024 * 1.37 && quality > 0.3) {
            quality -= 0.1;
            compressed = canvas.toDataURL('image/jpeg', quality);
          }
          
          console.log('[IMAGE] Compressed:', {
            original: file.size,
            compressed: Math.round(compressed.length / 1024),
            quality
          });
          
          resolve(compressed);
        };
        img.src = e.target.result;
      };
      
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  };
  
  const handleImageUpload = async (event) => {
    const file = event.target.files[0];
    if (!file) return;
    
    if (!file.type.startsWith('image/')) {
      showToast('×× × ×‘×—×¨ ×§×•×‘×¥ ×ª××•× ×”', 'error');
      return;
    }
    
    try {
      const compressed = await compressImage(file);
      setNewLocation(prev => ({ ...prev, uploadedImage: compressed }));
    } catch (error) {
      console.error('[IMAGE] Upload error:', error);
      showToast('×©×’×™××” ×‘×”×¢×œ××ª ×”×ª××•× ×”', 'error');
    }
  };

  const toggleInterest = (id) => {
    setFormData(prev => ({
      ...prev,
      interests: prev.interests.includes(id)
        ? prev.interests.filter(i => i !== id)
        : [...prev.interests, id]
    }));
  };

  // ============================================================================
  // CONSISTENT BUTTON STYLES - Used throughout the app
  // ============================================================================
  
  const getButtonStyle = (isActive = false, variant = 'primary') => {
    const baseStyle = {
      border: isActive ? '5px solid #f97316' : '3px solid #d1d5db',
      backgroundColor: isActive ? '#fed7aa' : '#ffffff',
      boxShadow: isActive ? '0 10px 15px -3px rgba(0, 0, 0, 0.3)' : 'none',
      padding: '12px 16px',
      borderRadius: '12px',
      fontWeight: 'bold',
      cursor: 'pointer',
      transition: 'all 0.2s'
    };
    
    // Variants for different button types
    if (variant === 'danger') {
      return {
        ...baseStyle,
        border: '3px solid #ef4444',
        backgroundColor: isActive ? '#fecaca' : '#ffffff',
        color: '#dc2626'
      };
    }
    
    if (variant === 'success') {
      return {
        ...baseStyle,
        border: '3px solid #10b981',
        backgroundColor: isActive ? '#d1fae5' : '#ffffff',
        color: '#059669'
      };
    }
    
    return baseStyle;
  };

  const getStopsForInterests = () => {
    // Now we only collect CUSTOM locations - Google Places will be fetched in generateRoute
    
    // Filter custom locations that match current area and selected interests
    const matchingCustomLocations = customLocations.filter(loc => {
      if (loc.area !== formData.area) return false;
      if (!loc.interests || loc.interests.length === 0) return false;
      
      // Check if location interests match selected interests
      return loc.interests.some(locInterest => {
        // Direct match
        if (formData.interests.includes(locInterest)) return true;
        
        // Check if selected interest is a custom one with baseCategory that matches
        for (const selectedInterest of formData.interests) {
          const customInterest = allInterestOptions.find(opt => 
            opt.id === selectedInterest && opt.custom && opt.baseCategory
          );
          
          if (customInterest && locInterest === customInterest.baseCategory) {
            return true;
          }
        }
        
        return false;
      });
    });
    
    // Remove duplicates
    const seen = new Set();
    return matchingCustomLocations.filter(stop => {
      const key = `${stop.lat},${stop.lng}`;
      if (seen.has(key)) return false;
      seen.add(key);
      return true;
    });
  };

  const generateRoute = async () => {
    if (!formData.area || formData.interests.length === 0) {
      showToast('âš ï¸ ×× × ×‘×—×¨ ××™×–×•×¨ ×•×œ×¤×—×•×ª ×ª×—×•× ×¢× ×™×™×Ÿ ××—×“', 'warning');
      return;
    }
    
    setIsGenerating(true);
    
    try {
      console.log(`[ROUTE] Starting route generation in ${formData.dataSource.toUpperCase()} mode`);
      
      // Get custom locations (always included)
      const customStops = getStopsForInterests();
      console.log('[ROUTE] Custom stops:', customStops.length);
      
      // Calculate stops needed per interest
      const numInterests = formData.interests.length || 1;
      const maxStops = formData.maxStops || 10;
      const stopsPerInterest = Math.ceil(maxStops / numInterests);
      
      // Track results per interest for smart completion
      const interestResults = {};
      const allStops = [...customStops]; // Start with custom stops (highest priority)
      let dataSourceErrors = [];
      
      // ROUND 1: Get places from selected data source
      for (const interest of formData.interests) {
        // Check how many custom stops we already have for this interest
        const customStopsForInterest = customStops.filter(stop => 
          stop.interests && stop.interests.includes(interest)
        );
        
        const neededForInterest = Math.max(0, stopsPerInterest - customStopsForInterest.length);
        
        if (neededForInterest > 0) {
          let fetchedPlaces = [];
          
          try {
            // ===== DATA SOURCE DECISION =====
            if (formData.dataSource === 'static') {
              // STATIC MODE: Use StaticDataManager
              console.log(`[STATIC] Fetching for interest: ${interest}`);
              fetchedPlaces = StaticDataManager.getLocations(formData.area, [interest]);
            } else {
              // DYNAMIC MODE: Use Google Places API
              console.log(`[DYNAMIC] Fetching for interest: ${interest}`);
              fetchedPlaces = await fetchGooglePlaces(formData.area, [interest]);
            }
          } catch (error) {
            // Track errors for user notification
            dataSourceErrors.push({
              interest,
              error: error.message || 'Unknown error',
              details: error.details || {}
            });
            console.error(`[ERROR] Failed to fetch for ${interest}:`, error);
            fetchedPlaces = [];
          }
          
          // Sort by rating and take what we need (or all if less available)
          const sortedPlaces = fetchedPlaces
            .sort((a, b) => (b.rating * Math.log10((b.ratingCount || 0) + 1)) - (a.rating * Math.log10((a.ratingCount || 0) + 1)))
            .slice(0, neededForInterest);
          
          // Track results
          interestResults[interest] = {
            requested: stopsPerInterest,
            custom: customStopsForInterest.length,
            fetched: sortedPlaces.length,
            total: customStopsForInterest.length + sortedPlaces.length,
            allPlaces: fetchedPlaces // Keep all for round 2
          };
          
          // Add to allStops
          allStops.push(...sortedPlaces);
        } else {
          // Already have enough from custom
          interestResults[interest] = {
            requested: stopsPerInterest,
            custom: customStopsForInterest.length,
            fetched: 0,
            total: customStopsForInterest.length,
            allPlaces: []
          };
        }
      }
      
      // Remove duplicates after round 1 - check ONLY exact name match
      // Allow same coordinates with different names (same physical location, different interests)
      const seen = new Set();
      let uniqueStops = allStops.filter(stop => {
        const normalizedName = stop.name.toLowerCase().trim();
        
        if (seen.has(normalizedName)) {
          console.log('[DEDUP] Removed duplicate by exact name:', stop.name);
          return false;
        }
        
        seen.add(normalizedName);
        return true;
      });
      
      // ROUND 2: If we didn't reach maxStops, try to add more from successful interests
      const totalFound = uniqueStops.length;
      const missing = maxStops - totalFound;
      
      console.log('[ROUTE] Round 1 complete:', { totalFound, maxStops, missing });
      
      if (missing > 0) {
        // Find interests that might have more places available
        const additionalPlaces = [];
        
        for (const interest of formData.interests) {
          const result = interestResults[interest];
          const alreadyUsed = result.fetched;
          const available = result.allPlaces.length;
          const canAddMore = available - alreadyUsed;
          
          if (canAddMore > 0) {
            // This interest has more places we can use
            const morePlaces = result.allPlaces
              .sort((a, b) => (b.rating * Math.log10((b.ratingCount || 0) + 1)) - (a.rating * Math.log10((a.ratingCount || 0) + 1)))
              .slice(alreadyUsed, alreadyUsed + canAddMore);
            
            additionalPlaces.push(...morePlaces);
          }
        }
        
        // Add additional places up to the missing amount
        const sorted = additionalPlaces
          .sort((a, b) => (b.rating * Math.log10((b.ratingCount || 0) + 1)) - (a.rating * Math.log10((a.ratingCount || 0) + 1)))
          .slice(0, missing);
        
        uniqueStops = [...uniqueStops, ...sorted];
        
        // Remove duplicates again - check ONLY exact name match
        const seenNames = new Set();
        const finalStops = [];
        
        for (const stop of uniqueStops) {
          const normalizedName = stop.name.toLowerCase().trim();
          
          if (!seenNames.has(normalizedName)) {
            finalStops.push(stop);
            seenNames.add(normalizedName);
          } else {
            console.log('[DEDUP Round 2] Removed duplicate:', stop.name);
          }
        }
        
        uniqueStops = finalStops;
        
        console.log('[ROUTE] Round 2 complete:', { added: sorted.length, total: uniqueStops.length });
      }
      
      // Show errors if any occurred
      if (dataSourceErrors.length > 0) {
        const errorMsg = dataSourceErrors.map(e => `${e.interest}: ${e.error}`).join(', ');
        
        console.error('[ROUTE] Data source errors:', dataSourceErrors);
        showToast(`âš ï¸ ×©×’×™××•×ª ×‘×§×‘×œ×ª ××§×•××•×ª: ${errorMsg}`, 'warning');
      }
      
      if (uniqueStops.length === 0) {
        const noDataMsg = formData.dataSource === 'static' 
          ? '×œ× × ××¦××• ××§×•××•×ª ×¡×˜×˜×™×™×. × ×¡×” ×ª×—×•××™ ×¢× ×™×™×Ÿ ××—×¨×™× ××• ×¢×‘×•×¨ ×œ××¦×‘ ×“×™× ××™.'
          : '×œ× × ××¦××• ××§×•××•×ª ×-Google API. ×•×“× ×©××ª×” ××—×•×¥ ×œ-Claude Artifacts.';
        
        showToast(noDataMsg, 'error');
        setIsGenerating(false);
        return;
      }
      
      let waypoints = uniqueStops.map(s => `${s.lat},${s.lng}`);
      
      // Build Google Maps URL with start point if provided
      let mapUrl;
      if (formData.startPoint && formData.startPoint.trim()) {
        // User provided a start point - use it as origin
        const origin = encodeURIComponent(formData.startPoint + ', Bangkok');
        const destination = formData.circular ? origin : waypoints[waypoints.length - 1];
        const waypointsStr = waypoints.join('|');
        mapUrl = `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}&waypoints=${waypointsStr}&travelmode=walking`;
      } else {
        // No start point - use first location as origin
        if (formData.circular && allStops.length > 1) {
          waypoints.push(waypoints[0]);
        }
        
        const origin = waypoints[0];
        const destination = waypoints[waypoints.length - 1];
        const middlePoints = waypoints.slice(1, -1).join('|');
        
        mapUrl = `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}`;
        if (middlePoints) {
          mapUrl += `&waypoints=${middlePoints}`;
        }
        mapUrl += '&travelmode=walking';
      }

      const selectedArea = areaOptions.find(a => a.id === formData.area);
      
      // Generate default name: "Area - interests #number"
      const areaName = selectedArea?.label || '×‘× ×§×•×§';
      const interestsText = formData.interests
        .map(id => allInterestOptions.filter(o => o && o.id).find(o => o.id === id)?.label)
        .filter(Boolean)
        .join(', ');
      
      // Find highest sequential number for similar routes
      const baseName = `${areaName} - ${interestsText}`;
      const existingNumbers = savedRoutes
        .filter(r => r.name && r.name.startsWith(baseName))
        .map(r => {
          const match = r.name.match(/#(\d+)$/);
          return match ? parseInt(match[1]) : 0;
        });
      const nextNumber = existingNumbers.length > 0 ? Math.max(...existingNumbers) + 1 : 1;
      const defaultName = `${baseName} #${nextNumber}`;
      
      const newRoute = {
        id: Date.now(),
        name: '', // Will be set when user saves
        defaultName: defaultName,
        createdAt: new Date().toISOString(),
        areaName: areaName,
        interestsText: interestsText,
        title: `${areaName} - ${uniqueStops.length} ××§×•××•×ª`,
        description: `××¡×œ×•×œ ${formData.circular ? '××¢×’×œ×™' : '×œ×™× ××¨×™'}`,
        duration: formData.hours, // Keep for backward compatibility but not displayed
        circular: formData.circular,
        startPoint: formData.startPoint || '×”×ª×—×œ×” ××”××§×•× ×”×¨××©×•×Ÿ ×‘×¨×©×™××”',
        stops: uniqueStops,
        mapUrl,
        preferences: { ...formData },
        stats: {
          custom: customStops.length,
          source: formData.dataSource,
          fetched: uniqueStops.length - customStops.length,
          total: uniqueStops.length
        },
        // Warning if didn't reach maxStops
        incomplete: uniqueStops.length < maxStops ? {
          requested: maxStops,
          found: uniqueStops.length,
          missing: maxStops - uniqueStops.length
        } : null,
        // Errors if any
        errors: dataSourceErrors.length > 0 ? dataSourceErrors : null
      };

      console.log('[ROUTE] Route created successfully:', {
        stops: newRoute.stops.length,
        stats: newRoute.stats,
        incomplete: newRoute.incomplete,
        errors: newRoute.errors
      });

      setRoute(newRoute);
      setRouteName(defaultName); // Set default name
      setCurrentView('route');
    } catch (error) {
      console.error('[ROUTE] Fatal error generating route:', error);
      
      const errorDetails = {
        message: error.message || 'Unknown error',
        stack: error.stack,
        dataSource: formData.dataSource
      };
      
      console.error('[ROUTE] Error details:', errorDetails);
      
      showToast(`âŒ ×©×’×™××” ×§×¨×™×˜×™×ª: ${error.message || '×©×’×™××” ×œ× ×™×“×•×¢×”'}. ×‘×“×•×§ Console (F12)`, 'error');
      
      // Fallback to static only
      const staticStops = getStopsForInterests();
      if (staticStops.length === 0) {
        setIsGenerating(false);
        return;
      }
      
      const newRoute = {
        id: Date.now(),
        stops: staticStops,
        // ... rest of route setup
      };
      setRoute(newRoute);
      setCurrentView('route');
    } finally {
      setIsGenerating(false);
    }
  };

  const saveRoute = () => {
    if (!routeName.trim()) {
      return; // Just don't save if no name
    }

    const routeToSave = {
      ...route,
      name: routeName.trim(),
      savedAt: new Date().toISOString()
    };

    const updated = [routeToSave, ...savedRoutes];
    setSavedRoutes(updated);
    localStorage.setItem('bangkok_saved_routes', JSON.stringify(updated));
    
    setShowSaveDialog(false);
    setRouteName('');
    setRoute(routeToSave); // Update route to show it's saved
  };

  const deleteRoute = (routeId) => {
    // Just delete without confirmation in sandbox
    const updated = savedRoutes.filter(r => r.id !== routeId);
    setSavedRoutes(updated);
    localStorage.setItem('bangkok_saved_routes', JSON.stringify(updated));
  };

  const loadSavedRoute = (savedRoute) => {
    setRoute(savedRoute);
    setFormData(savedRoute.preferences);
    setCurrentView('route');
  };

  const addCustomInterest = () => {
    if (!newInterest.label.trim() || !newInterest.baseCategory) {
      return; // Require both label and baseCategory
    }
    
    const interestToAdd = {
      id: `custom_${Date.now()}`,
      label: newInterest.label.trim(),
      icon: newInterest.icon || 'ğŸ“',
      baseCategory: newInterest.baseCategory, // Store the base category
      custom: true
    };
    
    const updated = [...customInterests, interestToAdd];
    setCustomInterests(updated);
    localStorage.setItem('bangkok_custom_interests', JSON.stringify(updated));
    
    // Reset and close dialog
    setNewInterest({ label: '', icon: 'ğŸ“', baseCategory: '' });
    setShowAddInterestDialog(false);
  };

  const deleteCustomInterest = (interestId) => {
    // Check if any custom locations use this interest
    const locationsUsingInterest = customLocations.filter(loc => 
      loc.interests && loc.interests.includes(interestId)
    );
    
    if (locationsUsingInterest.length > 0) {
      // Just remove the interest without warning (as we said in tips)
      const updated = customInterests.filter(i => i.id !== interestId);
      setCustomInterests(updated);
      localStorage.setItem('bangkok_custom_interests', JSON.stringify(updated));
    } else {
      const updated = customInterests.filter(i => i.id !== interestId);
      setCustomInterests(updated);
      localStorage.setItem('bangkok_custom_interests', JSON.stringify(updated));
    }
  };

  const deleteCustomLocation = (locationId) => {
    const updated = customLocations.filter(loc => loc.id !== locationId);
    setCustomLocations(updated);
    localStorage.setItem('bangkok_custom_locations', JSON.stringify(updated));
  };
  
  // Import function - add new only, skip existing
  const handleImportMerge = () => {
    // Add only new items - skip existing (by ID)
    const newInterests = [...customInterests];
    let addedInterests = 0;
    
    (importedData.customInterests || []).forEach(interest => {
      if (!newInterests.find(i => i.id === interest.id)) {
        newInterests.push(interest);
        addedInterests++;
      }
    });
    
    const newLocations = [...customLocations];
    let addedLocations = 0;
    
    (importedData.customLocations || []).forEach(loc => {
      if (!newLocations.find(l => l.id === loc.id)) {
        newLocations.push(loc);
        addedLocations++;
      }
    });
    
    setCustomInterests(newInterests);
    setCustomLocations(newLocations);
    localStorage.setItem('bangkok_custom_interests', JSON.stringify(newInterests));
    localStorage.setItem('bangkok_custom_locations', JSON.stringify(newLocations));
    setShowImportDialog(false);
    setImportedData(null);
    
    showToast(
      `âœ… ×™×•×‘×! × ×•×¡×¤×• ${addedInterests} ×ª×—×•××™× ×—×“×©×™×, ${addedLocations} ××§×•××•×ª ×—×“×©×™×`,
      'success'
    );
  };

  const addCustomLocation = () => {
    if (!newLocation.name.trim() || newLocation.interests.length === 0) {
      return; // Just don't add if validation fails
    }
    
    // Use provided coordinates or default to area center
    let lat = newLocation.lat;
    let lng = newLocation.lng;
    
    // If no coordinates provided, use default for the area
    if (lat === null || lng === null) {
      const defaults = areaCoordinates[newLocation.area] || areaCoordinates['sukhumvit'];
      lat = defaults.lat;
      lng = defaults.lng;
    }
    
    // Check if location is within area boundaries
    const boundaryCheck = checkLocationInArea(lat, lng, newLocation.area);
    const areaName = areaOptions.find(a => a.id === newLocation.area)?.label || newLocation.area;
    
    if (!boundaryCheck.valid) {
      showToast(
        `âš ï¸ ××–×”×¨×”: ×”××™×§×•× ${boundaryCheck.distanceKm} ×§"× ××—×•×¥ ×œ××–×•×¨ ${areaName}. × ×©××¨ ×‘×›×œ ×–××ª.`,
        'warning'
      );
    }
    
    const locationToAdd = {
      id: Date.now(),
      name: newLocation.name.trim(),
      description: newLocation.description.trim() || newLocation.notes?.trim() || '××§×•× ×©×”×•×¡×¤×ª×™',
      notes: newLocation.notes?.trim() || '',
      area: newLocation.area,
      interests: newLocation.interests,
      lat: lat,
      lng: lng,
      uploadedImage: newLocation.uploadedImage || null,
      imageUrls: newLocation.imageUrls || [],
      outsideArea: !boundaryCheck.valid, // Flag for outside area
      duration: 45,
      custom: true,
      addedAt: new Date().toISOString()
    };
    
    const updated = [...customLocations, locationToAdd];
    setCustomLocations(updated);
    localStorage.setItem('bangkok_custom_locations', JSON.stringify(updated));
    
    // Add to current route if exists
    if (route) {
      const updatedRoute = {
        ...route,
        stops: [...route.stops, locationToAdd]
      };
      setRoute(updatedRoute);
    }
    
    setShowAddLocationDialog(false);
    setNewLocation({ 
      name: '', 
      description: '', 
      notes: '',
      area: formData.area, 
      interests: [], 
      lat: null, 
      lng: null, 
      mapsUrl: '',
      uploadedImage: null,
      imageUrls: []
    });
  };
  
  // Update existing location
  const updateCustomLocation = () => {
    if (!newLocation.name || !newLocation.lat || !newLocation.lng) {
      showToast('âš ï¸ ×× × ××œ× ×©× ×•××™×§×•×', 'warning');
      return;
    }
    
    // Check if location is within area boundaries
    const boundaryCheck = checkLocationInArea(newLocation.lat, newLocation.lng, newLocation.area);
    const areaName = areaOptions.find(a => a.id === newLocation.area)?.label || newLocation.area;
    
    if (!boundaryCheck.valid) {
      showToast(
        `âš ï¸ ××–×”×¨×”: ×”××™×§×•× ${boundaryCheck.distanceKm} ×§"× ××—×•×¥ ×œ××–×•×¨ ${areaName}. × ×©××¨ ×‘×›×œ ×–××ª.`,
        'warning'
      );
    }
    
    const updatedLocation = { 
      ...newLocation, 
      custom: true, 
      id: editingLocation.id,
      outsideArea: !boundaryCheck.valid // Flag for outside area
    };
    
    const updated = customLocations.map(loc => 
      loc.id === editingLocation.id ? updatedLocation : loc
    );
    
    setCustomLocations(updated);
    localStorage.setItem('bangkok_custom_locations', JSON.stringify(updated));
    
    setShowEditLocationDialog(false);
    setEditingLocation(null);
    setNewLocation({ 
      name: '', 
      description: '', 
      notes: '',
      area: formData.area, 
      interests: [], 
      lat: null, 
      lng: null, 
      mapsUrl: '',
      uploadedImage: null,
      imageUrls: []
    });
  };

  // Get current location from GPS
  const getCurrentLocation = () => {
    if (!navigator.geolocation) {
      showToast('âŒ ×”×“×¤×“×¤×Ÿ ×©×œ×š ×œ× ×ª×•××š ×‘××™×§×•× GPS', 'error');
      return;
    }
    
    navigator.geolocation.getCurrentPosition(
      (position) => {
        setNewLocation({
          ...newLocation,
          lat: position.coords.latitude,
          lng: position.coords.longitude,
          mapsUrl: `https://maps.google.com/?q=${position.coords.latitude},${position.coords.longitude}`
        });
      },
      (error) => {
        let errorMessage = '×œ× ×”×¦×œ×—×ª×™ ×œ×§×‘×œ ××ª ×”××™×§×•×.';
        
        switch(error.code) {
          case error.PERMISSION_DENIED:
            errorMessage = '× ×“×¨×©×ª ×”×¨×©××” ×œ××™×§×•×. ×× × ××¤×©×¨ ×’×™×©×” ×‘××™×§×•× ×‘×”×’×“×¨×•×ª ×”×“×¤×“×¤×Ÿ.';
            break;
          case error.POSITION_UNAVAILABLE:
            errorMessage = '×”××™×§×•× ×œ× ×–××™×Ÿ ×›×¨×’×¢. × ×¡×” ×©×•×‘.';
            break;
          case error.TIMEOUT:
            errorMessage = '×ª× ×”×–××Ÿ ×œ×§×‘×œ×ª ×”××™×§×•×. × ×¡×” ×©×•×‘.';
            break;
        }
        
        showToast(`âŒ ${errorMessage}`, 'error');
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      }
    );
  };

  // Parse Google Maps URL to extract coordinates
  const parseMapsUrl = (url) => {
    if (!url || !url.trim()) {
      setNewLocation({ ...newLocation, lat: null, lng: null, mapsUrl: '' });
      return;
    }

    // Try different Google Maps URL formats
    let lat = null, lng = null;
    
    // Format 1: https://maps.google.com/?q=13.7465,100.4927
    let match = url.match(/[?&]q=([-\d.]+),([-\d.]+)/);
    if (match) {
      lat = parseFloat(match[1]);
      lng = parseFloat(match[2]);
    }
    
    // Format 2: https://www.google.com/maps/@13.7465,100.4927,17z
    if (!match) {
      match = url.match(/@([-\d.]+),([-\d.]+)/);
      if (match) {
        lat = parseFloat(match[1]);
        lng = parseFloat(match[2]);
      }
    }
    
    // Format 3: https://goo.gl/maps/... or https://maps.app.goo.gl/...
    // These shortened URLs need to be opened first, so just inform user
    if (!match && (url.includes('goo.gl') || url.includes('maps.app'))) {
      alert('ğŸ’¡ ×§×™×©×•×¨×™× ××§×•×¦×¨×™×: ×¤×ª×— ××ª ×”×§×™×©×•×¨ ×‘×“×¤×“×¤×Ÿ ×•×”×¢×ª×§ ××ª ×”×§×™×©×•×¨ ×”××œ×');
      setNewLocation({ ...newLocation, mapsUrl: url });
      return;
    }
    
    // Format 4: Just coordinates: 13.7465,100.4927 or 13.7465, 100.4927
    if (!match) {
      match = url.match(/^([-\d.]+)\s*,\s*([-\d.]+)$/);
      if (match) {
        lat = parseFloat(match[1]);
        lng = parseFloat(match[2]);
      }
    }
    
    if (lat !== null && lng !== null) {
      setNewLocation({ ...newLocation, lat, lng, mapsUrl: url });
      alert('âœ“ ×”×§×•××•×¨×“×™× ×˜×•×ª × ×§×œ×˜×• ×‘×”×¦×œ×—×”!');
    } else {
      alert('âŒ ×œ× ×”×¦×œ×—×ª×™ ×œ×–×”×•×ª ×§×•××•×¨×“×™× ×˜×•×ª. × ×¡×” ×œ×”×“×‘×™×§ ×§×™×©×•×¨ Google Maps ××• ×§×•××•×¨×“×™× ×˜×•×ª ×‘×¤×•×¨××˜: 13.7465,100.4927');
      setNewLocation({ ...newLocation, mapsUrl: url });
    }
  };

  const toggleStopActive = (stopIndex) => {
    const stopId = route.stops[stopIndex].id || stopIndex;
    const newDisabledStops = disabledStops.includes(stopId)
      ? disabledStops.filter(id => id !== stopId)
      : [...disabledStops, stopId];
    
    setDisabledStops(newDisabledStops);
    
    // Regenerate map URL with only active stops
    const activeStops = route.stops.filter((_, i) => 
      !newDisabledStops.includes(route.stops[i].id || i)
    );
    
    let waypoints = activeStops.map(s => `${s.lat},${s.lng}`);
    
    if (route.preferences.circular && activeStops.length > 1) {
      waypoints.push(waypoints[0]);
    }
    
    const origin = waypoints[0];
    const destination = waypoints[waypoints.length - 1];
    const middlePoints = waypoints.slice(1, -1).join('|');
    
    let mapUrl = `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${destination}`;
    if (middlePoints) {
      mapUrl += `&waypoints=${middlePoints}`;
    }
    mapUrl += '&travelmode=walking';
    
    setRoute({...route, mapUrl});
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-orange-50 to-pink-50" dir="rtl">
      <div className="bg-gradient-to-r from-orange-500 to-pink-500 text-white p-4 shadow-lg">
        <h1 className="text-2xl font-bold">Bangkok Explorer ğŸ‡¹ğŸ‡­</h1>
        <p className="text-sm text-orange-100">×”×”×¢×“×¤×•×ª × ×©××¨×•×ª ××•×˜×•××˜×™×ª</p>
      </div>

      <div className="max-w-4xl mx-auto p-4 pb-32">
        {/* Navigation Tabs */}
        <div className="grid grid-cols-4 gap-2 mb-4 bg-white rounded-lg p-2 shadow">
          <button
            onClick={() => setCurrentView('form')}
            className={`py-3 px-2 rounded-lg font-medium transition text-sm ${
              currentView === 'form' || currentView === 'route' ? 'bg-orange-500 text-white' : 'text-gray-600 hover:bg-gray-100'
            }`}
          >
            ğŸ—ºï¸ ××¡×œ×•×œ ×—×“×©
          </button>
          <button
            onClick={() => setCurrentView('search')}
            className={`py-3 px-2 rounded-lg font-medium transition text-sm ${
              currentView === 'search' ? 'bg-orange-500 text-white' : 'text-gray-600 hover:bg-gray-100'
            }`}
          >
            ğŸ” ×—×™×¤×•×©
          </button>
          <button
            onClick={() => setCurrentView('saved')}
            className={`py-3 px-2 rounded-lg font-medium transition text-sm ${
              currentView === 'saved' ? 'bg-orange-500 text-white' : 'text-gray-600 hover:bg-gray-100'
            }`}
          >
            ğŸ’¾ ××¡×œ×•×œ×™× ({savedRoutes.length})
          </button>
          <button
            onClick={() => setCurrentView('settings')}
            className={`py-3 px-2 rounded-lg font-medium transition text-sm ${
              currentView === 'settings' ? 'bg-orange-500 text-white' : 'text-gray-600 hover:bg-gray-100'
            }`}
          >
            âš™ï¸ ×”×’×“×¨×•×ª
          </button>
        </div>

        {/* Form View */}
        {currentView === 'form' && (
          <div className="bg-white rounded-xl shadow-lg p-4 space-y-4">
            <h2 className="text-xl font-bold">×ª×›× ×Ÿ ××ª ×”×˜×™×•×œ</h2>
            
            {/* Compact settings */}
            <div className="flex gap-4 items-center p-3 bg-gray-50 rounded-lg">
              {/* Hours field - HIDDEN (not deleted, may use later) */}
              <div className="flex items-center gap-2 flex-1" style={{ display: 'none' }}>
                <label className="text-xs font-medium">â°</label>
                <select
                  value={formData.hours}
                  onChange={(e) => setFormData({...formData, hours: parseInt(e.target.value)})}
                  className="flex-1 p-2 border-2 border-gray-300 rounded-lg text-sm font-medium bg-white"
                >
                  <option value={1}>1 ×©×¢×”</option>
                  <option value={2}>2 ×©×¢×•×ª</option>
                  <option value={3}>3 ×©×¢×•×ª</option>
                  <option value={4}>4 ×©×¢×•×ª</option>
                  <option value={5}>5 ×©×¢×•×ª</option>
                  <option value={6}>6 ×©×¢×•×ª</option>
                  <option value={7}>7 ×©×¢×•×ª</option>
                  <option value={8}>8 ×©×¢×•×ª</option>
                </select>
              </div>
              {/* Circular/Linear buttons */}
              <div className="flex gap-2">
                <button
                  onClick={() => setFormData({...formData, circular: true})}
                  style={{
                    border: formData.circular ? '5px solid #f97316' : '3px solid #d1d5db',
                    backgroundColor: formData.circular ? '#fed7aa' : '#ffffff',
                    boxShadow: formData.circular ? '0 10px 15px -3px rgba(0, 0, 0, 0.3)' : 'none',
                    padding: '8px 16px',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '14px'
                  }}
                  title="××¢×’×œ×™ - ×—×–×¨×” ×œ× ×§×•×“×ª ×”×”×ª×—×œ×”"
                >
                  ğŸ”„ ××¢×’×œ×™
                </button>
                <button
                  onClick={() => setFormData({...formData, circular: false})}
                  style={{
                    border: !formData.circular ? '5px solid #f97316' : '3px solid #d1d5db',
                    backgroundColor: !formData.circular ? '#fed7aa' : '#ffffff',
                    boxShadow: !formData.circular ? '0 10px 15px -3px rgba(0, 0, 0, 0.3)' : 'none',
                    padding: '8px 16px',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '14px'
                  }}
                  title="×œ×™× ××¨×™ - ×× ×§×•×“×” ×œ× ×§×•×“×”"
                >
                  â¡ï¸ ×œ×™× ××¨×™
                </button>
              </div>
            </div>

            <div>
              <label className="text-xs text-gray-600 mb-1 block">ğŸ“ × ×§×•×“×ª ×”×ª×—×œ×” (××•×¤×¦×™×•× ×œ×™)</label>
              <input
                type="text"
                value={formData.startPoint}
                onChange={(e) => setFormData({...formData, startPoint: e.target.value})}
                placeholder="×œ×“×•×’××”: BTS Asok, ×©× ××œ×•×Ÿ..."
                className="w-full p-2 border border-gray-300 rounded-lg text-sm"
              />
            </div>

            <div>
              <label className="font-medium text-sm mb-2 block">ğŸ—ºï¸ ××™×–×•×¨</label>
              <div className="grid grid-cols-3 gap-2">
                {areaOptions.map(area => (
                  <button
                    key={area.id}
                    onClick={() => setFormData({...formData, area: area.id})}
                    style={{
                      border: formData.area === area.id ? '5px solid #f97316' : '3px solid #d1d5db',
                      backgroundColor: formData.area === area.id ? '#fed7aa' : '#ffffff',
                      boxShadow: formData.area === area.id ? '0 10px 15px -3px rgba(0, 0, 0, 0.3)' : 'none'
                    }}
                    className="p-2 rounded-lg text-xs"
                  >
                    <div className="text-xl mb-1">{area.icon}</div>
                    <div style={{
                      fontWeight: 'bold',
                      color: formData.area === area.id ? '#c2410c' : '#374151'
                    }}>{area.label}</div>
                  </button>
                ))}
              </div>
            </div>

            <div>
              <label className="font-medium text-sm mb-2 block">â­ ××” ××¢× ×™×™×Ÿ?</label>
              <div className="grid grid-cols-3 gap-2 max-h-60 overflow-y-auto border border-gray-200 rounded-lg p-2">
                {allInterestOptions.filter(option => option && option.id).map(option => {
                  const tooltip = interestTooltips[option.id] || option.label;
                  const customInterest = customInterests.find(ci => ci.id === option.id);
                  const isCustom = !!customInterest;
                  
                  return (
                    <button
                      key={option.id}
                      onClick={() => toggleInterest(option.id)}
                      title={tooltip}
                      style={{
                        border: formData.interests.includes(option.id) ? '5px solid #f97316' : '3px solid #d1d5db',
                        backgroundColor: formData.interests.includes(option.id) ? '#fed7aa' : '#ffffff',
                        boxShadow: formData.interests.includes(option.id) ? '0 10px 15px -3px rgba(0, 0, 0, 0.3)' : 'none',
                        position: 'relative'
                      }}
                      className="p-2 rounded-lg text-xs"
                    >
                      <div className="text-lg mb-1">{option.icon}</div>
                      <div style={{
                        fontWeight: '600',
                        color: formData.interests.includes(option.id) ? '#c2410c' : '#374151'
                      }}>{option.label}</div>
                      {/* Info icon - purple and larger for custom interests */}
                      <div style={{
                        position: 'absolute',
                        top: '3px',
                        left: '3px',
                        fontSize: isCustom ? '14px' : '12px',
                        color: isCustom ? '#a855f7' : '#9ca3af',
                        opacity: isCustom ? '1' : '0.7',
                        fontWeight: isCustom ? 'bold' : 'normal'
                      }}>â“˜</div>
                    </button>
                  );
                })}
              </div>
              {formData.interests.length > 0 && (
                <div style={{
                  marginTop: '8px',
                  fontSize: '14px',
                  fontWeight: 'bold',
                  color: '#059669',
                  backgroundColor: '#d1fae5',
                  padding: '8px',
                  borderRadius: '8px'
                }}>
                  âœ“ {formData.interests.length} × ×‘×—×¨×•
                </div>
              )}
            </div>

            {/* Generate Button - sticky at bottom for mobile */}
            <div style={{
              position: 'sticky',
              bottom: '20px',
              zIndex: 100,
              marginTop: '20px'
            }}>
              <button
                onClick={generateRoute}
                disabled={formData.interests.length === 0}
                style={{
                  width: '100%',
                  background: 'linear-gradient(to right, #f97316, #ec4899)',
                  color: 'white',
                  padding: '20px',
                  borderRadius: '16px',
                  fontWeight: 'bold',
                  fontSize: '20px',
                  border: 'none',
                  boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.5)',
                  opacity: formData.interests.length === 0 ? 0.5 : 1
                }}
              >
                {isGenerating ? '××—×©×‘ ××¡×œ×•×œ...' : 'ğŸ—ºï¸ ×—×©×‘ ××¡×œ×•×œ'}
              </button>
            </div>
            
            {formData.interests.length === 0 && (
              <p className="text-center text-gray-500 text-sm">×‘×—×¨ ×œ×¤×—×•×ª ×ª×—×•× ×¢× ×™×™×Ÿ ××—×“</p>
            )}

            {/* Show stops list ONLY after route is calculated */}
            {route && (
              <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mt-4">
                <h3 className="font-bold mb-3 text-blue-900">××§×•××•×ª ×‘{route.areaName} ({route.stops.length}):</h3>
                <div className="space-y-2 max-h-60 overflow-y-auto">
                  {route.stops.map((stop, i) => (
                    <div key={i} className="bg-white p-2 rounded border">
                      <div className="flex justify-between items-start">
                        <div className="flex-1">
                          <div className="font-bold text-sm flex items-center gap-1">
                            <span>{i + 1}. {stop.name}</span>
                            {stop.outsideArea && (
                              <span 
                                className="text-orange-500" 
                                title="××§×•× ××—×•×¥ ×œ×’×‘×•×œ×•×ª ×”××–×•×¨"
                                style={{ fontSize: '12px' }}
                              >
                                ğŸ”º
                              </span>
                            )}
                          </div>
                          <div className="text-xs text-gray-600">{stop.description}</div>
                          <div className="text-xs text-gray-500">â±ï¸ {stop.duration} ×“×§×•×ª</div>
                        </div>
                        <a
                          href={`https://www.google.com/maps/search/${encodeURIComponent(stop.name)}/@${stop.lat},${stop.lng},17z`}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="text-blue-500 hover:text-blue-700 text-xs ml-2"
                        >
                          ğŸ“ ××¤×”
                        </a>
                      </div>
                    </div>
                  ))}
                </div>
                
                <div className="mt-3 space-y-2">
                  <a
                    href={(() => {
                      const avgLat = route.stops.reduce((sum, s) => sum + s.lat, 0) / route.stops.length;
                      const avgLng = route.stops.reduce((sum, s) => sum + s.lng, 0) / route.stops.length;
                      const query = route.stops.map(s => s.name).join(' OR ');
                      return `https://www.google.com/maps/search/${encodeURIComponent(query)}/@${avgLat},${avgLng},14z`;
                    })()}
                    target="_blank"
                    rel="noopener noreferrer"
                    style={{
                      display: 'block',
                      width: '100%',
                      backgroundColor: '#22c55e',
                      color: 'white',
                      textAlign: 'center',
                      padding: '14px',
                      borderRadius: '12px',
                      fontWeight: 'bold',
                      textDecoration: 'none',
                      fontSize: '16px',
                      boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.3)',
                      marginBottom: '8px'
                    }}
                  >
                    â­ ×”×¦×’ ××ª ×›×œ ×”××§×•××•×ª ×¢×œ ×”××¤×” (×œ×œ× ××¡×œ×•×œ)
                  </a>
                  
                  <button
                    onClick={() => setCurrentView('route')}
                    style={{
                      display: 'block',
                      width: '100%',
                      backgroundColor: '#2563eb',
                      color: 'white',
                      textAlign: 'center',
                      padding: '14px',
                      borderRadius: '12px',
                      fontWeight: 'bold',
                      fontSize: '16px',
                      border: 'none',
                      boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.3)'
                    }}
                  >
                    ğŸ—ºï¸ ×¤×ª×— ××¡×œ×•×œ ×¢× × ×™×•×•×˜ ×‘-Google Maps
                  </button>
                </div>
              </div>
            )}
          </div>
        )}

        {currentView === 'route' && route && (
          <div className="bg-white rounded-xl shadow-lg p-4">
            <button
              onClick={() => setCurrentView('form')}
              style={getButtonStyle(false)}
              className="mb-4"
            >
              â† ×—×–×¨×” ×œ×˜×•×¤×¡
            </button>

            {/* Save Route Button */}
            {!route.name && (
              <button
                onClick={() => setShowSaveDialog(true)}
                className="w-full bg-purple-500 text-white py-3 rounded-lg font-bold hover:bg-purple-600 mb-4"
              >
                ğŸ’¾ ×©××•×¨ ××¡×œ×•×œ ×–×”
              </button>
            )}

            {route.name && (
              <div className="bg-green-50 border-2 border-green-500 p-3 rounded-lg mb-4">
                <p className="text-green-800 font-medium">ğŸ“Œ {route.name}</p>
                <p className="text-xs text-green-600">× ×©××¨ ×‘-{new Date(route.savedAt).toLocaleDateString('he-IL')}</p>
              </div>
            )}

            <h2 className="text-2xl font-bold mb-2">{route.areaName} - {route.interestsText || '×›×œ×œ×™'}</h2>
            <p className="text-sm text-gray-600 mb-2">
              × ×§×•×“×ª ×”×ª×—×œ×”: {route.startPoint}
            </p>
            
            {/* Stats - show breakdown of place sources */}
            {route.stats && (route.stats.custom > 0 || route.stats.fetched > 0) && (
              <div className="bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-200 rounded-lg p-3 mb-4">
                <div className="text-xs font-bold text-gray-700 mb-2">ğŸ“Š ××§×•×¨×•×ª ×”××§×•××•×ª:</div>
                <div className="flex gap-2 flex-wrap">
                  {route.stats.custom > 0 && (
                    <span className="bg-purple-500 text-white text-xs px-2 py-1 rounded-full font-bold">
                      â­ {route.stats.custom} ××•×ª×××™× ××™×©×™×ª
                    </span>
                  )}
                  {route.stats.fetched > 0 && (
                    <span className={`text-white text-xs px-2 py-1 rounded-full font-bold ${
                      route.stats.source === 'static' ? 'bg-purple-600' : 'bg-green-600'
                    }`}>
                      {route.stats.source === 'static' ? 'ğŸ“š' : 'ğŸŒ'} {route.stats.fetched} {route.stats.source === 'static' ? '×¡×˜×˜×™' : '×-Google API'}
                    </span>
                  )}
                </div>
              </div>
            )}

            {/* Errors display if any */}
            {route.errors && route.errors.length > 0 && (
              <div className="bg-red-50 border-2 border-red-400 rounded-lg p-3 mb-4">
                <div className="flex items-start gap-2">
                  <span className="text-xl">âŒ</span>
                  <div className="flex-1">
                    <p className="text-sm font-bold text-red-800 mb-1">×©×’×™××•×ª ×‘×§×‘×œ×ª ××§×•××•×ª</p>
                    <div className="text-xs text-red-700 space-y-1">
                      {route.errors.map((err, i) => (
                        <div key={i}>â€¢ {err.interest}: {err.error}</div>
                      ))}
                    </div>
                    <p className="text-xs text-red-600 mt-2">
                      ×¤×¨×˜×™× ××œ××™× ×‘-Console (F12) - ×”×¢×ª×§ ×•×©×œ×— ×œ×ª×™×§×•×Ÿ
                    </p>
                  </div>
                </div>
              </div>
            )}

            {/* Warning if didn't reach requested max stops */}
            {route.incomplete && (
              <div className="bg-yellow-50 border-2 border-yellow-400 rounded-lg p-3 mb-4">
                <div className="flex items-start gap-2">
                  <span className="text-xl">âš ï¸</span>
                  <div className="flex-1">
                    <p className="text-sm font-bold text-yellow-800 mb-1">
                      × ××¦××• {route.incomplete.found} ××§×•××•×ª ×‘××§×•× {route.incomplete.requested} ×”××‘×•×§×©×™×
                    </p>
                    <p className="text-xs text-yellow-700">
                      {formData.interests.length === 1 
                        ? '××™×Ÿ ××¡×¤×™×§ ××§×•××•×ª ×ª×•×××™× ×‘×ª×—×•× ×–×” ×‘××–×•×¨ ×”× ×‘×—×¨'
                        : '×œ× × ××¦××• ××¡×¤×™×§ ××§×•××•×ª ×ª×•×××™× ×‘×—×œ×§ ××ª×—×•××™ ×”×¢× ×™×™×Ÿ ×‘××–×•×¨ ×”× ×‘×—×¨'}
                    </p>
                  </div>
                </div>
              </div>
            )}

            <div className="space-y-3 mb-6">
              <div className="flex justify-between items-center mb-3">
                <h3 className="font-bold">×ª×—× ×•×ª ({route.stops.length}):</h3>
                <button
                  onClick={() => {
                    setNewLocation(prev => ({...prev, area: formData.area}));
                    setShowAddLocationDialog(true);
                  }}
                  className="bg-purple-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-purple-600"
                >
                  â• ×”×•×¡×£ ××§×•×
                </button>
              </div>
              {route.stops.map((stop, i) => {
                const stopId = stop.id || i;
                const isDisabled = disabledStops.includes(stopId);
                
                // Determine source badge
                let sourceBadge = null;
                if (stop.custom) {
                  sourceBadge = { text: 'â­ ×©×œ×™', color: 'bg-purple-500', title: '××§×•× ××•×ª×× ××™×©×™×ª' };
                } else {
                  // Everything else is from Google Places
                  sourceBadge = { text: 'ğŸ” Google', color: 'bg-blue-500', title: '×××§×•××•×ª Google Places' };
                }
                
                return (
                  <div key={i} className={`border-r-4 pr-3 py-2 ${isDisabled ? 'border-gray-300 opacity-50' : 'border-orange-500'}`}>
                    <div className="flex justify-between items-start gap-2">
                      <div className="flex gap-2 flex-1">
                        <div className={`rounded-full w-6 h-6 flex items-center justify-center font-bold text-sm flex-shrink-0 ${isDisabled ? 'bg-gray-400 text-white' : 'bg-orange-500 text-white'}`}>
                          {isDisabled ? 'âœ•' : i + 1}
                        </div>
                        <div className="flex-1">
                          <div className="flex items-center gap-2 flex-wrap">
                            <h4 className={`font-bold text-sm ${isDisabled ? 'line-through text-gray-500' : ''}`}>
                              {stop.name}
                            </h4>
                            {stop.outsideArea && (
                              <span 
                                className="text-orange-500" 
                                title="××§×•× ××—×•×¥ ×œ×’×‘×•×œ×•×ª ×”××–×•×¨"
                                style={{ fontSize: '14px' }}
                              >
                                ğŸ”º
                              </span>
                            )}
                            {stop.custom ? (
                              <div className="relative group">
                                <button
                                  onClick={() => {
                                    setSelectedLocation(stop);
                                    setShowLocationDetailModal(true);
                                  }}
                                  className={`${sourceBadge.color} text-white text-[10px] px-2 py-0.5 rounded-full font-bold cursor-pointer hover:opacity-80 transition`}
                                  title="×œ×—×¥ ×œ×¤×¨×˜×™× ××œ××™×"
                                >
                                  {sourceBadge.text}
                                </button>
                                
                                {/* Hover Tooltip */}
                                <div className="absolute bottom-full left-0 mb-2 hidden group-hover:block z-50 w-64">
                                  <div className="bg-gray-900 text-white p-3 rounded-lg shadow-2xl text-xs">
                                    {stop.uploadedImage && (
                                      <img 
                                        src={stop.uploadedImage} 
                                        alt={stop.name}
                                        className="w-full h-24 object-cover rounded mb-2"
                                      />
                                    )}
                                    <div className="font-bold mb-1">{stop.name}</div>
                                    {stop.description && (
                                      <div className="text-gray-300 mb-1">{stop.description}</div>
                                    )}
                                    {stop.notes && (
                                      <div className="text-gray-400 italic">ğŸ’­ {stop.notes}</div>
                                    )}
                                    <div className="text-gray-400 mt-2 text-[9px]">ğŸ‘† ×œ×—×¥ ×œ×¤×¨×˜×™× ××œ××™×</div>
                                  </div>
                                </div>
                              </div>
                            ) : (
                              <span 
                                className={`${sourceBadge.color} text-white text-[10px] px-2 py-0.5 rounded-full font-bold`}
                                title={sourceBadge.title}
                              >
                                {sourceBadge.text}
                              </span>
                            )}
                          </div>
                          <p className="text-xs text-gray-600">{stop.description}</p>
                          <p className="text-xs text-gray-500">â±ï¸ {stop.duration} ×“×§×•×ª</p>
                        </div>
                      </div>
                      <div className="flex gap-1 flex-shrink-0">
                        <button
                          onClick={() => toggleStopActive(i)}
                          className={`text-xs px-2 py-1 rounded ${isDisabled ? 'bg-green-500 text-white' : 'bg-gray-300 text-gray-700'}`}
                          title={isDisabled ? '×”×¤×¢×œ' : '×”×©×‘×ª'}
                        >
                          {isDisabled ? 'âœ“' : 'â¸'}
                        </button>
                        <a
                          href={`https://www.google.com/maps/search/${encodeURIComponent(stop.name)}/@${stop.lat},${stop.lng},17z`}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="text-blue-500 hover:text-blue-700 text-xs"
                        >
                          ğŸ“
                        </a>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>

            <div className="space-y-3 mb-4">
              <a
                href={(() => {
                  const avgLat = route.stops.reduce((sum, s) => sum + s.lat, 0) / route.stops.length;
                  const avgLng = route.stops.reduce((sum, s) => sum + s.lng, 0) / route.stops.length;
                  const query = route.stops.map(s => s.name).join(' OR ');
                  return `https://www.google.com/maps/search/${encodeURIComponent(query)}/@${avgLat},${avgLng},14z`;
                })()}
                target="_blank"
                rel="noopener noreferrer"
                style={{
                  display: 'block',
                  width: '100%',
                  backgroundColor: '#22c55e',
                  color: 'white',
                  textAlign: 'center',
                  padding: '14px',
                  borderRadius: '12px',
                  fontWeight: 'bold',
                  textDecoration: 'none',
                  fontSize: '16px',
                  boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.3)',
                  marginBottom: '12px'
                }}
              >
                â­ ×”×¦×’ ××ª ×›×œ ×”××§×•××•×ª ×¢×œ ×”××¤×” (×œ×œ× ××¡×œ×•×œ)
              </a>

              <a
                href={route.mapUrl}
                target="_blank"
                rel="noopener noreferrer"
                style={{
                  display: 'block',
                  width: '100%',
                  backgroundColor: '#2563eb',
                  color: 'white',
                  textAlign: 'center',
                  padding: '16px',
                  borderRadius: '12px',
                  fontWeight: 'bold',
                  textDecoration: 'none',
                  fontSize: '16px',
                  boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.3)'
                }}
              >
                ğŸ—ºï¸ ×¤×ª×— ×‘-Google Maps ×¢× × ×™×•×•×˜ ××œ×
              </a>
            </div>
          </div>
        )}

        {/* Saved Routes View */}
        {/* Search View */}
        {currentView === 'search' && (
          <div className="bg-white rounded-xl shadow-lg p-4">
            <h2 className="text-2xl font-bold mb-4">ğŸ” ×—×™×¤×•×© ×‘××§×•××•×ª ×©×œ×™</h2>
            
            <div className="mb-4">
              <input
                type="text"
                placeholder="×—×¤×© ×‘×©×, ×ª×™××•×¨ ××• ×”×¢×¨×•×ª..."
                value={searchQuery}
                className="w-full p-3 border-3 border-gray-300 rounded-xl text-base focus:border-orange-500 focus:ring-2 focus:ring-orange-200"
                style={{ textAlign: 'right', direction: 'rtl' }}
                onChange={(e) => {
                  const query = e.target.value;
                  setSearchQuery(query);
                  
                  if (!query.trim()) {
                    setSearchResults([]);
                    return;
                  }
                  
                  const queryLower = query.toLowerCase();
                  const results = customLocations.filter(loc => 
                    loc.name.toLowerCase().includes(queryLower) ||
                    (loc.description && loc.description.toLowerCase().includes(queryLower)) ||
                    (loc.notes && loc.notes.toLowerCase().includes(queryLower))
                  );
                  setSearchResults(results);
                }}
              />
            </div>
            
            {/* Search Results */}
            {searchQuery && searchResults.length > 0 ? (
              <div className="space-y-3">
                <p className="text-sm text-gray-600 font-bold">× ××¦××• {searchResults.length} ×ª×•×¦××•×ª:</p>
                {searchResults.map(loc => (
                  <div
                    key={loc.id}
                    className="bg-gradient-to-r from-green-50 to-teal-50 border-3 border-green-400 rounded-xl p-4"
                  >
                    <div className="flex justify-between items-start mb-2">
                      <div className="flex-1">
                        <h3 className="text-lg font-bold text-green-900 flex items-center gap-2">
                          <span>{loc.name}</span>
                          {loc.outsideArea && (
                            <span 
                              className="text-orange-500" 
                              title="××§×•× ××—×•×¥ ×œ×’×‘×•×œ×•×ª ×”××–×•×¨"
                              style={{ fontSize: '16px' }}
                            >
                              ğŸ”º
                            </span>
                          )}
                        </h3>
                        <p className="text-sm text-green-700 mt-1">{loc.description || '××™×Ÿ ×ª×™××•×¨'}</p>
                        {loc.notes && (
                          <p className="text-xs text-green-600 mt-1 italic">ğŸ’­ {loc.notes}</p>
                        )}
                      </div>
                      <button
                        onClick={() => {
                          setEditingLocation(loc);
                          setNewLocation(loc);
                          setShowEditLocationDialog(true);
                        }}
                        className="bg-blue-500 text-white px-3 py-2 rounded-lg text-sm font-bold"
                      >
                        âœï¸ ×¢×¨×•×š
                      </button>
                    </div>
                    
                    {/* Image Preview */}
                    {loc.uploadedImage && (
                      <img 
                        src={loc.uploadedImage} 
                        alt={loc.name}
                        className="w-full h-32 object-cover rounded-lg mt-2 cursor-pointer border-2 border-green-300"
                        onClick={() => {
                          setModalImage(loc.uploadedImage);
                          setShowImageModal(true);
                        }}
                      />
                    )}
                    
                    {/* Interests Tags */}
                    {loc.interests && loc.interests.length > 0 && (
                      <div className="flex flex-wrap gap-1 mt-2">
                        {loc.interests.map(intId => {
                          const interest = allInterestOptions.find(opt => opt.id === intId);
                          return interest ? (
                            <span key={intId} className="bg-green-600 text-white text-xs px-2 py-1 rounded-full">
                              {interest.icon} {interest.label}
                            </span>
                          ) : null;
                        })}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            ) : searchQuery && searchResults.length === 0 ? (
              <div className="text-center py-12 text-gray-500">
                <div className="text-6xl mb-4">ğŸ”</div>
                <p className="font-bold">×œ× × ××¦××• ×ª×•×¦××•×ª ×¢×‘×•×¨ "{searchQuery}"</p>
                <p className="text-sm mt-2">× ×¡×” ×œ×—×¤×© ××©×”×• ××—×¨</p>
              </div>
            ) : customLocations.length === 0 ? (
              <div className="text-center py-12 text-gray-500">
                <div className="text-6xl mb-4">ğŸ“</div>
                <p className="font-bold">×¢×“×™×™×Ÿ ××™×Ÿ ××§×•××•×ª ××•×ª×××™× ××™×©×™×ª</p>
                <p className="text-sm mt-2">×”×•×¡×£ ××§×•××•×ª ×›×“×™ ×œ×—×¤×© ×‘×”×</p>
              </div>
            ) : (
              <div className="text-center py-12 text-gray-500">
                <div className="text-6xl mb-4">ğŸ”</div>
                <p className="font-bold">×”×ª×—×œ ×œ×”×§×œ×™×“ ×›×“×™ ×œ×—×¤×©</p>
                <p className="text-sm mt-2">×™×© ×œ×š {customLocations.length} ××§×•××•×ª ××•×ª×××™× ××™×©×™×ª</p>
              </div>
            )}
          </div>
        )}

        {currentView === 'saved' && (
          <div className="bg-white rounded-xl shadow-lg p-4">
            <h2 className="text-xl font-bold mb-4">××¡×œ×•×œ×™× ×©××•×¨×™×</h2>
            
            {savedRoutes.length === 0 ? (
              <div className="text-center py-12">
                <div className="text-6xl mb-4">ğŸ—ºï¸</div>
                <p className="text-gray-600 mb-4">×¢×“×™×™×Ÿ ××™×Ÿ ××¡×œ×•×œ×™× ×©××•×¨×™×</p>
                <button
                  onClick={() => setCurrentView('form')}
                  className="bg-orange-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-orange-600"
                >
                  ×¦×•×¨ ××¡×œ×•×œ ×—×“×©
                </button>
              </div>
            ) : (
              <div className="space-y-4">
                {savedRoutes.map(savedRoute => (
                  <div key={savedRoute.id} className="border-2 border-gray-200 rounded-lg p-4 hover:border-orange-300 transition">
                    <div className="flex justify-between items-start mb-2">
                      <div className="flex-1">
                        <h3 className="text-lg font-bold text-gray-800">{savedRoute.name}</h3>
                        <p className="text-sm text-gray-600">{savedRoute.areaName} â€¢ {savedRoute.interestsText || '×›×œ×œ×™'}</p>
                        <p className="text-xs text-gray-500 mt-1">
                          {savedRoute.stops.length} ×ª×—× ×•×ª â€¢ 
                          × ×©××¨: {new Date(savedRoute.savedAt).toLocaleDateString('he-IL')}
                        </p>
                      </div>
                      <button
                        onClick={() => deleteRoute(savedRoute.id)}
                        className="text-red-500 hover:text-red-700 text-sm ml-2"
                      >
                        ğŸ—‘ï¸ ××—×§
                      </button>
                    </div>
                    
                    <div className="flex gap-2 mt-3">
                      <button
                        onClick={() => loadSavedRoute(savedRoute)}
                        className="flex-1 bg-blue-500 text-white py-2 rounded-lg font-medium hover:bg-blue-600"
                      >
                        ğŸ“ ×¤×ª×— ××¡×œ×•×œ
                      </button>
                      <a
                        href={savedRoute.mapUrl}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="flex-1 bg-green-500 text-white text-center py-2 rounded-lg font-medium hover:bg-green-600"
                      >
                        ğŸ—ºï¸ Google Maps
                      </a>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}

        {/* Settings View */}
        {currentView === 'settings' && (
          <div className="bg-white rounded-xl shadow-lg p-4">
            <h2 className="text-xl font-bold mb-4">âš™ï¸ ×”×’×“×¨×•×ª</h2>
            
            {/* Max Stops Setting */}
            <div className="mb-6">
              <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-3 border-blue-400 rounded-xl p-4">
                <h3 className="text-lg font-bold text-gray-800 mb-2">ğŸ“ ××¡×¤×¨ ××§×•××•×ª ×‘××¡×œ×•×œ</h3>
                <p className="text-sm text-gray-600 mb-3">
                  ×›××” ××§×•××•×ª ××§×¡×™××œ×™ ×œ×”×¦×™×’ ×‘××¡×œ×•×œ? (×™×—×•×œ×§ ×©×•×•×” ×‘×™×Ÿ ×ª×—×•××™ ×”×¢× ×™×™×Ÿ)
                </p>
                <div className="flex items-center gap-4">
                  <input
                    type="range"
                    min="5"
                    max="20"
                    value={formData.maxStops}
                    onChange={(e) => setFormData({...formData, maxStops: parseInt(e.target.value)})}
                    className="flex-1"
                    style={{ accentColor: '#3b82f6' }}
                  />
                  <div className="bg-blue-500 text-white px-4 py-2 rounded-lg font-bold text-lg min-w-[60px] text-center">
                    {formData.maxStops}
                  </div>
                </div>
                <div className="flex justify-between text-xs text-gray-500 mt-2">
                  <span>××¢×˜ (5)</span>
                  <span>×‘×¨×™×¨×ª ××—×“×œ (10)</span>
                  <span>×”×¨×‘×” (20)</span>
                </div>
              </div>
            </div>
            
            {/* Data Source Setting - Static vs Dynamic */}
            <div className="mb-6">
              <div className="bg-gradient-to-r from-purple-50 to-pink-50 border-3 border-purple-400 rounded-xl p-4">
                <h3 className="text-lg font-bold text-gray-800 mb-2">ğŸ”„ ××§×•×¨ × ×ª×•× ×™×</h3>
                <p className="text-sm text-gray-600 mb-3">
                  ×‘×—×¨ ××™×š ×œ×§×‘×œ ××§×•××•×ª: ×¨×©×™××” ×§×‘×•×¢×” ××• ×—×™×¤×•×© ×‘×’×•×’×œ
                </p>
                
                {/* Toggle buttons */}
                <div className="flex gap-3 mb-3">
                  <button
                    onClick={() => setFormData({...formData, dataSource: 'static'})}
                    className={`flex-1 py-3 px-4 rounded-lg font-bold text-sm transition ${
                      formData.dataSource === 'static' 
                        ? 'bg-purple-500 text-white shadow-lg' 
                        : 'bg-white text-gray-600 border-2 border-purple-200'
                    }`}
                  >
                    ğŸ“š ×¨×©×™××” ×§×‘×•×¢×”
                  </button>
                  <button
                    onClick={() => setFormData({...formData, dataSource: 'dynamic'})}
                    className={`flex-1 py-3 px-4 rounded-lg font-bold text-sm transition ${
                      formData.dataSource === 'dynamic' 
                        ? 'bg-green-500 text-white shadow-lg' 
                        : 'bg-white text-gray-600 border-2 border-green-200'
                    }`}
                  >
                    ğŸŒ ×—×™×¤×•×© ×‘×’×•×’×œ
                  </button>
                </div>
                
                {/* Explanation based on selection */}
                {formData.dataSource === 'static' ? (
                  <div className="bg-purple-100 border-2 border-purple-300 rounded-lg p-3">
                    <p className="text-xs text-purple-900">
                      <strong>ğŸ“š ×¨×©×™××” ×§×‘×•×¢×”:</strong> ××©×ª××© ×‘-100+ ××§×•××•×ª ××•×›× ×™× ××¨××©. 
                      ××•××œ×¥ ×œ×“×™×‘××’ ×‘×ª×•×š Claude Artifacts.
                    </p>
                  </div>
                ) : (
                  <div className="bg-green-100 border-2 border-green-300 rounded-lg p-3">
                    <p className="text-xs text-green-900">
                      <strong>ğŸŒ ×—×™×¤×•×© ×‘×’×•×’×œ:</strong> ××—×¤×© ××§×•××•×ª ×‘-Google Places API ×‘×–××Ÿ ×××ª. 
                      ×¢×•×‘×“ ×¨×§ ××—×•×¥ ×œ-Claude (GitHub/Browser).
                    </p>
                  </div>
                )}
                
                {/* Refresh static data button */}
                {formData.dataSource === 'static' && (
                  <button
                    onClick={() => {
                      console.log('[STATIC] Manual refresh triggered');
                      // No toast needed - data is always ready
                    }}
                    className="w-full mt-3 bg-purple-600 text-white py-2 px-4 rounded-lg font-bold hover:bg-purple-700 transition"
                  >
                    ğŸ”„ ×¨×¢× ×Ÿ × ×ª×•× ×™× ×¡×˜×˜×™×™×
                  </button>
                )}
              </div>
            </div>
            
            {/* Custom Interests Section */}
            <div className="mb-6">
              <div className="flex justify-between items-center mb-3">
                <h3 className="text-lg font-bold">×ª×—×•××™ ×¢× ×™×™×Ÿ ××•×ª×××™× ××™×©×™×ª</h3>
                <button
                  onClick={() => setShowAddInterestDialog(true)}
                  style={{
                    backgroundColor: '#8b5cf6',
                    color: 'white',
                    padding: '8px 16px',
                    borderRadius: '8px',
                    fontSize: '14px',
                    fontWeight: 'bold',
                    border: 'none',
                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                  }}
                >
                  â• ×”×•×¡×£ ×ª×—×•× ×—×“×©
                </button>
              </div>

              {customInterests.length === 0 ? (
                <div className="text-center py-8 bg-gray-50 rounded-lg">
                  <div className="text-4xl mb-2">ğŸ¯</div>
                  <p className="text-gray-600">×¢×“×™×™×Ÿ ××™×Ÿ ×ª×—×•××™ ×¢× ×™×™×Ÿ ××•×ª×××™× ××™×©×™×ª</p>
                  <p className="text-sm text-gray-500 mt-1">×œ×—×¥ "×”×•×¡×£ ×ª×—×•× ×—×“×©" ×›×“×™ ×œ×™×¦×•×¨</p>
                </div>
              ) : (
                <div className="grid grid-cols-3 gap-2">
                  {customInterests.map(interest => (
                    <div
                      key={interest.id}
                      style={{
                        border: '3px solid #8b5cf6',
                        borderRadius: '12px',
                        padding: '12px',
                        backgroundColor: '#f3e8ff',
                        position: 'relative'
                      }}
                    >
                      <button
                        onClick={() => deleteCustomInterest(interest.id)}
                        style={{
                          position: 'absolute',
                          top: '4px',
                          right: '4px',
                          backgroundColor: '#ef4444',
                          color: 'white',
                          border: 'none',
                          borderRadius: '50%',
                          width: '24px',
                          height: '24px',
                          fontSize: '14px',
                          cursor: 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center'
                        }}
                        title="××—×§"
                      >
                        Ã—
                      </button>
                      <div style={{ textAlign: 'center', marginTop: '8px' }}>
                        <div style={{ fontSize: '24px', marginBottom: '4px' }}>{interest.icon}</div>
                        <div style={{ fontSize: '12px', fontWeight: 'bold', color: '#6b21a8' }}>
                          {interest.label}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Custom Locations Section */}
            <div className="mb-6">
              <div className="flex justify-between items-center mb-3">
                <h3 className="text-lg font-bold">×”××§×•××•×ª ×©×œ×™ ({customLocations.length})</h3>
                <button
                  onClick={() => setShowAddLocationDialog(true)}
                  style={{
                    backgroundColor: '#10b981',
                    color: 'white',
                    padding: '8px 16px',
                    borderRadius: '8px',
                    fontSize: '14px',
                    fontWeight: 'bold',
                    border: 'none',
                    boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                  }}
                >
                  â• ×”×•×¡×£ ××§×•× ×—×“×©
                </button>
              </div>
              
              {customLocations.length === 0 ? (
                <div className="text-center py-8 bg-gray-50 rounded-lg">
                  <div className="text-4xl mb-2">ğŸ“</div>
                  <p className="text-gray-600">×¢×“×™×™×Ÿ ××™×Ÿ ××§×•××•×ª ××•×ª×××™× ××™×©×™×ª</p>
                  <p className="text-sm text-gray-500 mt-1">×œ×—×¥ "×”×•×¡×£ ××§×•× ×—×“×©" ×›×“×™ ×œ×™×¦×•×¨</p>
                </div>
              ) : (
                <div className="space-y-2 max-h-60 overflow-y-auto">
                  {customLocations.map(loc => (
                    <div
                      key={loc.id}
                      style={{
                        border: '3px solid #10b981',
                        borderRadius: '12px',
                        padding: '12px',
                        backgroundColor: '#d1fae5',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        gap: '8px'
                      }}
                    >
                      <div style={{ flex: 1 }}>
                        <div style={{ fontWeight: 'bold', fontSize: '15px', color: '#065f46', display: 'flex', alignItems: 'center', gap: '6px' }}>
                          <span>{loc.name}</span>
                          {loc.outsideArea && (
                            <span 
                              style={{ color: '#f97316', fontSize: '14px' }}
                              title="××§×•× ××—×•×¥ ×œ×’×‘×•×œ×•×ª ×”××–×•×¨"
                            >
                              ğŸ”º
                            </span>
                          )}
                        </div>
                        <div style={{ fontSize: '12px', color: '#047857', marginTop: '4px' }}>
                          {loc.description || '××™×Ÿ ×ª×™××•×¨'}
                        </div>
                        {loc.notes && (
                          <div style={{ fontSize: '11px', color: '#059669', marginTop: '2px', fontStyle: 'italic' }}>
                            ğŸ’­ {loc.notes}
                          </div>
                        )}
                      </div>
                      <div style={{ display: 'flex', gap: '4px' }}>
                        <button
                          onClick={() => {
                            setEditingLocation(loc);
                            setNewLocation(loc);
                            setShowEditLocationDialog(true);
                          }}
                          style={{
                            backgroundColor: '#3b82f6',
                            color: 'white',
                            border: 'none',
                            borderRadius: '8px',
                            padding: '6px 12px',
                            fontSize: '12px',
                            fontWeight: 'bold',
                            cursor: 'pointer',
                            boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                          }}
                        >
                          âœï¸ ×¢×¨×•×š
                        </button>
                        <button
                          onClick={() => deleteCustomLocation(loc.id)}
                          style={{
                            backgroundColor: '#ef4444',
                            color: 'white',
                            border: 'none',
                            borderRadius: '8px',
                            padding: '6px 12px',
                            fontSize: '12px',
                            fontWeight: 'bold',
                            cursor: 'pointer',
                            boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                          }}
                        >
                          ğŸ—‘ï¸ ××—×§
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Import/Export Section */}
            <div className="mb-6">
              <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-3 border-blue-400 rounded-xl p-4">
                <h3 className="text-lg font-bold text-gray-800 mb-2">ğŸ’¾ ×™×™×‘×•× ×•×™×™×¦×•× × ×ª×•× ×™×</h3>
                <p className="text-sm text-gray-600 mb-4">
                  ×©××•×¨ ××ª ×ª×—×•××™ ×”×¢× ×™×™×Ÿ ×•×”××§×•××•×ª ×©×œ×š, ×•×”×¢×‘×¨ ××•×ª× ×‘×™×Ÿ ××›×©×™×¨×™×
                </p>
                
                <div className="space-y-3">
                  {/* Export Button */}
                  <button
                    onClick={() => {
                      try {
                        const data = {
                          customInterests: customInterests,
                          customLocations: customLocations,
                          exportDate: new Date().toISOString().split('T')[0],
                          version: '1.2'
                        };
                        
                        const dataStr = JSON.stringify(data, null, 2);
                        const dataBlob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(dataBlob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `bangkok-data-${data.exportDate}.json`;
                        link.click();
                        URL.revokeObjectURL(url);
                        
                        showToast(`âœ… ×”×§×•×‘×¥ ×”×•×¨×“! (${customInterests.length} ×ª×—×•××™×, ${customLocations.length} ××§×•××•×ª)`, 'success');
                      } catch (error) {
                        console.error('[EXPORT] Error:', error);
                        showToast('âŒ ×©×’×™××” ×‘×™×™×¦×•× ×”× ×ª×•× ×™×', 'error');
                      }
                    }}
                    className="w-full bg-blue-500 text-white py-3 px-4 rounded-lg font-bold hover:bg-blue-600 transition flex items-center justify-center gap-2"
                  >
                    <span>ğŸ“¤</span>
                    <span>×™×™×¦× ××ª ×”× ×ª×•× ×™× ×©×œ×™</span>
                    <span className="text-xs bg-blue-600 px-2 py-1 rounded">
                      {customInterests.length} ×ª×—×•××™×, {customLocations.length} ××§×•××•×ª
                    </span>
                  </button>
                  
                  {/* Import Button */}
                  <div>
                    <input
                      type="file"
                      accept=".json"
                      onChange={(e) => {
                        const file = e.target.files?.[0];
                        if (!file) return;
                        
                        const reader = new FileReader();
                        reader.onload = (event) => {
                          try {
                            const data = JSON.parse(event.target.result);
                            
                            // Validate data structure
                            if (!data.customInterests || !data.customLocations) {
                              showToast('âŒ ×§×•×‘×¥ ×œ× ×ª×§×™×Ÿ - ×—×¡×¨×™× ×©×“×•×ª × ×“×¨×©×™×', 'error');
                              return;
                            }
                            
                            // Show import dialog with options
                            setImportedData(data);
                            setShowImportDialog(true);
                          } catch (error) {
                            console.error('[IMPORT] Error:', error);
                            showToast('âŒ ×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥ - ×•×•×“× ×©×–×” ×§×•×‘×¥ JSON ×ª×§×™×Ÿ', 'error');
                          }
                        };
                        reader.readAsText(file);
                        
                        // Reset input
                        e.target.value = '';
                      }}
                      id="importData"
                      className="hidden"
                    />
                    <label
                      htmlFor="importData"
                      className="block w-full bg-green-500 text-white py-3 px-4 rounded-lg font-bold hover:bg-green-600 transition text-center cursor-pointer"
                    >
                      ğŸ“¥ ×™×™×‘× × ×ª×•× ×™× ××§×•×‘×¥
                    </label>
                  </div>
                  
                  {/* Info Box */}
                  <div className="bg-blue-100 border-2 border-blue-300 rounded-lg p-3 text-xs">
                    <p className="text-blue-900 mb-1">
                      <strong>ğŸ’¡ ×˜×™×¤:</strong> ×”×©×ª××© ×‘×™×™×‘×•×/×™×™×¦×•× ×›×“×™:
                    </p>
                    <ul className="text-blue-800 space-y-1 mr-4">
                      <li>â€¢ ×œ×”×¢×‘×™×¨ × ×ª×•× ×™× ×‘×™×Ÿ Claude ×œ-GitHub</li>
                      <li>â€¢ ×œ×”×¢×‘×™×¨ ×‘×™×Ÿ ××—×©×‘ ×œ×˜×œ×¤×•×Ÿ</li>
                      <li>â€¢ ×œ×’×‘×•×ª ××ª ×”× ×ª×•× ×™× ×©×œ×š</li>
                      <li>â€¢ ×œ×©×ª×£ ×¢× ×—×‘×¨×™×</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            {/* Uncovered Interests Section */}
            <div className="mb-6">
              <div className="bg-gradient-to-br from-yellow-50 to-orange-50 border-3 border-orange-400 rounded-xl p-4">
                <h3 className="text-lg font-bold text-gray-800 mb-2">â„¹ï¸ ×ª×—×•××™ ×¢× ×™×™×Ÿ ×©×œ× × ×›×œ×œ×™× ×‘××¢×¨×›×ª</h3>
                <p className="text-sm text-gray-600 mb-4">
                  ×”××¢×¨×›×ª ×××•×§×“×ª ×‘×ª×™×™×¨×•×ª ×•×˜×™×•×œ×™×. ×”×ª×—×•××™× ×”×‘××™× <strong>×œ× × ×›×œ×œ×™×</strong> ×‘×—×™×¤×•×©:
                </p>
                
                <div className="space-y-2">
                  {uncoveredInterests.map((interest, idx) => (
                    <div key={idx} className="bg-white rounded-lg p-2 border-2 border-orange-200">
                      <div className="flex items-center gap-2">
                        <div className="text-2xl">{interest.icon}</div>
                        <div className="flex-1">
                          <h4 className="font-bold text-gray-800 text-sm">{interest.name}</h4>
                          <p className="text-xs text-gray-600">{interest.examples}</p>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
                
                <div className="bg-orange-100 border-2 border-orange-400 rounded-lg p-3 mt-3">
                  <p className="text-xs text-orange-900">
                    <strong>ğŸ’¡ ×˜×™×¤:</strong> ×× ××ª×” ×¦×¨×™×š ×ª×—×•× ×©×œ× ×‘××¢×¨×›×ª, ×”×©×ª××© ×‘<strong>"â• ×”×•×¡×£ ×ª×—×•× ×—×“×©"</strong> ×œ××¢×œ×”!
                  </p>
                </div>
              </div>
            </div>

            {/* Info Section */}
            <div style={{
              backgroundColor: '#eff6ff',
              border: '2px solid #3b82f6',
              borderRadius: '12px',
              padding: '12px',
              marginTop: '16px'
            }}>
              <h4 style={{ fontWeight: 'bold', marginBottom: '8px', color: '#1e40af' }}>ğŸ’¡ ×˜×™×¤×™×:</h4>
              <ul style={{ fontSize: '13px', color: '#1e3a8a', listStyle: 'disc', paddingRight: '20px' }}>
                <li>×ª×—×•× ×¢× ×™×™×Ÿ ×—×“×© ××•×¦×’ ×¢× ×”×©× ×©×œ×š ××‘×œ ××¨××” ××§×•××•×ª ××ª×—×•× ×”×‘×¡×™×¡</li>
                <li>×œ×“×•×’××”: "×‘×ª×™ ×§×•×œ× ×•×¢" ××‘×•×¡×¡ ×¢×œ "××¨×›×™×˜×§×˜×•×¨×”" - ×™×¦×™×’ ××ª ×›×œ ××§×•××•×ª ×”××¨×›×™×˜×§×˜×•×¨×”</li>
                <li>××§×•××•×ª ××•×ª×××™× ×©×ª×•×¡×™×£ ×™×•×¤×™×¢×• ××•×˜×•××˜×™×ª ×œ×¤×™ ×ª×—×•××™ ×”×¢× ×™×™×Ÿ</li>
                <li>××—×™×§×ª ×ª×—×•× ×¢× ×™×™×Ÿ ×œ× ×ª××—×§ ××§×•××•×ª ×§×™×™××™×</li>
              </ul>
            </div>
          </div>
        )}

        {/* Save Dialog */}
        {showSaveDialog && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50" style={{ paddingBottom: '0' }}>
            <div className="bg-white rounded-t-xl p-6 w-full max-w-md mb-0">
              <h3 className="text-xl font-bold mb-4">×©××•×¨ ××¡×œ×•×œ</h3>
              <label className="block text-sm font-medium mb-2">×©× ×”××¡×œ×•×œ:</label>
              <input
                type="text"
                value={routeName}
                onChange={(e) => setRouteName(e.target.value)}
                placeholder="×œ×“×•×’××”: ×˜×™×•×œ ×¨××©×•×Ÿ ×‘×‘× ×§×•×§"
                className="w-full p-3 border-2 border-gray-300 rounded-lg mb-4"
                style={{ textAlign: 'right', direction: 'rtl' }}
                autoFocus
              />
              <div className="flex gap-3">
                <button
                  onClick={saveRoute}
                  className="flex-1 bg-green-500 text-white py-3 rounded-lg font-bold hover:bg-green-600"
                >
                  ğŸ’¾ ×©××•×¨
                </button>
                <button
                  onClick={() => {
                    setShowSaveDialog(false);
                    setRouteName('');
                  }}
                  className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400"
                >
                  ×‘×™×˜×•×œ
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Add Location Dialog */}
        {(showAddLocationDialog || showEditLocationDialog) && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50" style={{ paddingBottom: '0' }}>
            <div className="bg-white rounded-t-2xl w-full max-h-[70vh] overflow-y-auto mb-0" style={{ paddingBottom: 'env(safe-area-inset-bottom)' }}>
              {/* Header */}
              <div className="sticky top-0 bg-white border-b-2 border-gray-200 px-6 py-4 rounded-t-2xl z-10">
                <h3 className="text-2xl font-bold text-gray-800">
                  {showEditLocationDialog ? 'âœï¸ ×¢×¨×•×š ××§×•×' : 'â• ×”×•×¡×£ ××§×•× ×—×“×©'}
                </h3>
              </div>
              
              {/* Content with padding */}
              <div className="px-6 py-4 space-y-4">
                {/* Name Input */}
                <div>
                  <label className="block text-base font-bold mb-2 text-gray-700">
                    ×©× ×”××§×•×: <span className="text-red-500">*</span>
                  </label>
                  <input
                    type="text"
                    value={newLocation.name}
                    onChange={(e) => setNewLocation({...newLocation, name: e.target.value})}
                    placeholder="×œ×“×•×’××”: Cafe Amazon"
                    className="w-full p-3 border-3 border-gray-300 rounded-xl text-base focus:border-orange-500 focus:ring-2 focus:ring-orange-200"
                    style={{ textAlign: 'right', direction: 'rtl' }}
                    autoFocus
                  />
                </div>
                
                {/* Description Input */}
                <div>
                  <label className="block text-base font-bold mb-2 text-gray-700">×ª×™××•×¨:</label>
                  <textarea
                    value={newLocation.description || ''}
                    onChange={(e) => setNewLocation({...newLocation, description: e.target.value})}
                    placeholder="×œ×“×•×’××”: ×§×¤×” ××¢×•×œ×” ×œ×™×“ ×”××œ×•×Ÿ, ×™×© wifi ××”×™×¨"
                    className="w-full p-3 border-3 border-gray-300 rounded-xl text-base focus:border-orange-500 focus:ring-2 focus:ring-orange-200"
                    style={{ textAlign: 'right', direction: 'rtl', minHeight: '80px' }}
                    rows="3"
                  />
                </div>
                
                {/* Notes Input */}
                <div>
                  <label className="block text-base font-bold mb-2 text-gray-700">×”×¢×¨×•×ª ×¤×¨×˜×™×•×ª:</label>
                  <textarea
                    value={newLocation.notes || ''}
                    onChange={(e) => setNewLocation({...newLocation, notes: e.target.value})}
                    placeholder="×œ×“×•×’××”: ×¤×ª×•×— ×¢×“ 22:00, ××•××œ×¥ ×œ×‘×•× ×‘×‘×•×§×¨"
                    className="w-full p-3 border-3 border-gray-300 rounded-xl text-base focus:border-orange-500 focus:ring-2 focus:ring-orange-200"
                    style={{ textAlign: 'right', direction: 'rtl', minHeight: '80px' }}
                    rows="3"
                  />
                </div>
                
                {/* Image Upload Section */}
                <div className="bg-gradient-to-br from-purple-50 to-pink-50 border-3 border-purple-400 rounded-2xl p-4">
                  <label className="block text-base font-bold mb-3 text-purple-900">ğŸ“· ×ª××•× ×•×ª:</label>
                  
                  {/* Uploaded Image Preview */}
                  {newLocation.uploadedImage && (
                    <div className="mb-3 relative">
                      <img 
                        src={newLocation.uploadedImage} 
                        alt="Preview"
                        className="w-full h-48 object-cover rounded-lg border-3 border-purple-300 cursor-pointer"
                        onClick={() => {
                          setModalImage(newLocation.uploadedImage);
                          setShowImageModal(true);
                        }}
                      />
                      <button
                        onClick={() => {
                          setNewLocation({...newLocation, uploadedImage: null});
                        }}
                        className="absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 font-bold"
                      >
                        âœ•
                      </button>
                    </div>
                  )}
                  
                  {/* Upload Button */}
                  {!newLocation.uploadedImage && (
                    <div>
                      <input
                        type="file"
                        accept="image/*"
                        onChange={handleImageUpload}
                        id="imageUpload"
                        className="hidden"
                      />
                      <label
                        htmlFor="imageUpload"
                        className="block w-full bg-purple-500 text-white text-center py-3 rounded-lg font-bold cursor-pointer hover:bg-purple-600 transition"
                      >
                        ğŸ“¤ ×”×¢×œ×” ×ª××•× ×” (×™×™×“×—×¡ ××•×˜×•××˜×™×ª)
                      </label>
                    </div>
                  )}
                  
                  {/* Image URLs */}
                  <div className="mt-3">
                    <label className="block text-sm font-bold mb-2 text-purple-900">ğŸ”— ×§×™×©×•×¨×™ ×ª××•× ×•×ª × ×•×¡×¤×™×:</label>
                    {(newLocation.imageUrls || []).map((url, idx) => (
                      <div key={idx} className="flex gap-2 mb-2">
                        <input
                          type="url"
                          value={url}
                          onChange={(e) => {
                            const urls = [...(newLocation.imageUrls || [])];
                            urls[idx] = e.target.value;
                            setNewLocation({...newLocation, imageUrls: urls});
                          }}
                          placeholder="https://example.com/image.jpg"
                          className="flex-1 p-2 border-2 border-purple-300 rounded-lg text-sm"
                        />
                        <button
                          onClick={() => {
                            const urls = (newLocation.imageUrls || []).filter((_, i) => i !== idx);
                            setNewLocation({...newLocation, imageUrls: urls});
                          }}
                          className="bg-red-500 text-white px-3 rounded-lg font-bold"
                        >
                          âœ•
                        </button>
                      </div>
                    ))}
                    <button
                      onClick={() => {
                        const urls = [...(newLocation.imageUrls || []), ''];
                        setNewLocation({...newLocation, imageUrls: urls});
                      }}
                      className="w-full bg-purple-100 text-purple-800 py-2 rounded-lg font-bold hover:bg-purple-200 transition text-sm"
                    >
                      â• ×”×•×¡×£ ×§×™×©×•×¨
                    </button>
                  </div>
                </div>
                
                {/* Area Select */}
                <div>
                  <label className="block text-base font-bold mb-2 text-gray-700">××™×–×•×¨:</label>
                  <select
                    value={newLocation.area}
                    onChange={(e) => setNewLocation({...newLocation, area: e.target.value})}
                    className="w-full p-3 border-3 border-gray-300 rounded-xl text-base bg-white focus:border-orange-500 focus:ring-2 focus:ring-orange-200"
                  >
                    {areaOptions.map(area => (
                      <option key={area.id} value={area.id}>
                        {area.icon} {area.label}
                      </option>
                    ))}
                  </select>
                </div>
                
                {/* Location Section - Improved with status */}
                <div className="bg-gradient-to-br from-blue-50 to-indigo-50 border-3 border-blue-400 rounded-2xl p-4">
                  <label className="block text-base font-bold mb-3 text-blue-900">ğŸ“ ××™×§×•× (××•×¤×¦×™×•× ×œ×™):</label>
                  
                  {/* Status Display */}
                  {newLocation.lat !== null && newLocation.lng !== null ? (
                    <div className="bg-green-500 text-white rounded-xl p-4 mb-3 shadow-lg">
                      <div className="flex items-center justify-between mb-2">
                        <div className="flex items-center gap-2">
                          <span className="text-2xl">âœ…</span>
                          <span className="font-bold text-lg">××™×§×•× × ×§×œ×˜!</span>
                        </div>
                        <button
                          onClick={() => setNewLocation({...newLocation, lat: null, lng: null, mapsUrl: ''})}
                          className="bg-white text-red-600 px-3 py-1 rounded-lg text-sm font-bold hover:bg-red-50"
                        >
                          âœ• ×‘×˜×œ
                        </button>
                      </div>
                      <div className="text-sm font-mono bg-green-600 rounded p-2">
                        {newLocation.lat.toFixed(6)}, {newLocation.lng.toFixed(6)}
                      </div>
                    </div>
                  ) : null}
                  
                  {/* Current Location Button */}
                  <button
                    onClick={getCurrentLocation}
                    disabled={newLocation.lat !== null}
                    className={`w-full py-3 rounded-xl text-base font-bold shadow-md mb-3 flex items-center justify-center gap-2 ${
                      newLocation.lat !== null 
                        ? 'bg-gray-300 text-gray-500 cursor-not-allowed' 
                        : 'bg-green-500 text-white hover:bg-green-600'
                    }`}
                  >
                    <span className="text-xl">ğŸ“</span>
                    <span>×”×©×ª××© ×‘××™×§×•× ×”× ×•×›×—×™ ×©×œ×™</span>
                  </button>
                  
                  {/* Divider */}
                  <div className="flex items-center gap-3 my-3">
                    <div className="flex-1 border-t-2 border-blue-300"></div>
                    <span className="text-sm text-blue-700 font-bold">××•</span>
                    <div className="flex-1 border-t-2 border-blue-300"></div>
                  </div>
                  
                  {/* Google Maps URL Input */}
                  <div>
                    <label className="block text-sm font-bold mb-2 text-blue-800">ğŸ”— ×”×“×‘×§ ×§×™×©×•×¨ Google Maps:</label>
                    <input
                      type="text"
                      value={newLocation.mapsUrl}
                      onChange={(e) => parseMapsUrl(e.target.value)}
                      disabled={newLocation.lat !== null}
                      placeholder="×”×“×‘×§ ×§×™×©×•×¨ ××•: 13.7465,100.4927"
                      className={`w-full p-3 border-2 rounded-lg text-sm ${
                        newLocation.lat !== null
                          ? 'bg-gray-100 border-gray-300 text-gray-500 cursor-not-allowed'
                          : 'bg-white border-blue-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200'
                      }`}
                      style={{ textAlign: 'right', direction: 'rtl' }}
                    />
                    <div className="text-xs text-blue-700 mt-2 font-medium">
                      ğŸ’¡ ×ª×•××š ×‘×›×œ ×¡×•×’×™ ×§×™×©×•×¨×™ Google Maps
                    </div>
                  </div>
                </div>
                
                {/* Interests Selection */}
                <div>
                  <label className="block text-base font-bold mb-2 text-gray-700">×ª×—×•××™ ×¢× ×™×™×Ÿ:</label>
                  <div className="grid grid-cols-3 gap-2 p-2 bg-gray-50 rounded-xl max-h-40 overflow-y-auto">
                    {allInterestOptions.filter(option => option && option.id).map(option => (
                      <button
                        key={option.id}
                        onClick={() => {
                          const interests = newLocation.interests.includes(option.id)
                            ? newLocation.interests.filter(i => i !== option.id)
                            : [...newLocation.interests, option.id];
                          setNewLocation({...newLocation, interests});
                        }}
                        className={`p-2 rounded-lg text-sm transition-all ${
                          newLocation.interests.includes(option.id) 
                            ? 'border-3 border-purple-500 bg-purple-100 shadow-md' 
                            : 'border-2 border-gray-300 bg-white'
                        }`}
                      >
                        <div className="text-xl mb-1">{option.icon}</div>
                        <div className="font-bold text-[10px]">{option.label}</div>
                      </button>
                    ))}
                  </div>
                  
                  {/* Selected Count */}
                  {newLocation.interests.length > 0 && (
                    <div className="mt-2 text-xs font-bold text-green-600 bg-green-50 p-2 rounded-lg">
                      âœ“ × ×‘×—×¨×• {newLocation.interests.length} ×ª×—×•××™×
                    </div>
                  )}
                </div>
                
                {/* Add Interest Button */}
                <button
                  onClick={() => setShowAddInterestDialog(true)}
                  className="w-full bg-blue-500 text-white py-3 rounded-xl text-sm font-bold hover:bg-blue-600"
                >
                  â• ×¦×•×¨ ×ª×—×•× ×¢× ×™×™×Ÿ ×—×“×©
                </button>
              </div>
              
              {/* Footer Buttons - Sticky */}
              <div className="sticky bottom-0 bg-white border-t-3 border-gray-300 px-6 py-3 shadow-2xl">
                <div className="flex gap-2">
                  <button
                    onClick={() => {
                      if (!newLocation.name || !newLocation.name.trim()) {
                        showToast('âš ï¸ ×× × ××œ× ××ª ×©× ×”××§×•×', 'warning');
                        return;
                      }
                      if (newLocation.interests.length === 0) {
                        showToast('âš ï¸ ×× × ×‘×—×¨ ×œ×¤×—×•×ª ×ª×—×•× ×¢× ×™×™×Ÿ ××—×“', 'warning');
                        return;
                      }
                      
                      if (showEditLocationDialog) {
                        updateCustomLocation();
                      } else {
                        addCustomLocation();
                      }
                    }}
                    disabled={!newLocation.name || !newLocation.name.trim() || newLocation.interests.length === 0}
                    className={`flex-1 py-3 rounded-xl text-base font-bold shadow-md transition-all ${
                      newLocation.name && newLocation.name.trim() && newLocation.interests.length > 0
                        ? 'bg-purple-500 text-white hover:bg-purple-600'
                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                    }`}
                  >
                    {showEditLocationDialog ? '×¢×“×›×Ÿ' : '×”×•×¡×£'}
                  </button>
                  <button
                    onClick={() => {
                      setShowAddLocationDialog(false);
                      setShowEditLocationDialog(false);
                      setEditingLocation(null);
                      setNewLocation({ 
                        name: '', 
                        description: '', 
                        notes: '',
                        area: formData.area, 
                        interests: [], 
                        lat: null, 
                        lng: null, 
                        mapsUrl: '',
                        uploadedImage: null,
                        imageUrls: []
                      });
                    }}
                    className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl text-base font-bold hover:bg-gray-300"
                  >
                    ×‘×™×˜×•×œ
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Add Custom Interest Dialog */}
        {showAddInterestDialog && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50" style={{ paddingBottom: '0' }}>
            <div className="bg-white rounded-t-xl p-6 w-full max-w-md max-h-[75vh] overflow-y-auto mb-0">
              <h3 className="text-xl font-bold mb-4">â• ×”×•×¡×£ ×ª×—×•× ×¢× ×™×™×Ÿ ×—×“×©</h3>
              
              <label className="block text-sm font-medium mb-2">×©× ×”×ª×—×•×:</label>
              <input
                type="text"
                value={newInterest.label}
                onChange={(e) => setNewInterest({...newInterest, label: e.target.value})}
                placeholder="×œ×“×•×’××”: ×‘×ª×™ ×§×•×œ× ×•×¢"
                className="w-full p-3 border-2 border-gray-300 rounded-lg mb-4"
                style={{ textAlign: 'right', direction: 'rtl' }}
              />

              <label className="block text-sm font-medium mb-2">××™×™×§×•×Ÿ (××™××•×’'×™):</label>
              <input
                type="text"
                value={newInterest.icon}
                onChange={(e) => setNewInterest({...newInterest, icon: e.target.value})}
                placeholder="ğŸ“"
                maxLength="2"
                style={{ fontSize: '24px', textAlign: 'center' }}
                className="w-full p-3 border-2 border-gray-300 rounded-lg mb-4"
              />

              <label className="block text-sm font-medium mb-2">ğŸ”— ××‘×•×¡×¡ ×¢×œ ×ª×—×•× ×§×™×™×:</label>
              <select
                value={newInterest.baseCategory || ''}
                onChange={(e) => setNewInterest({...newInterest, baseCategory: e.target.value})}
                className="w-full p-3 border-2 border-gray-300 rounded-lg mb-4"
              >
                <option value="">-- ×‘×—×¨ ×ª×—×•× ×‘×¡×™×¡ --</option>
                {interestOptions.map(option => (
                  <option key={option.id} value={option.id}>
                    {option.icon} {option.label}
                  </option>
                ))}
              </select>

              <div style={{
                backgroundColor: '#dbeafe',
                border: '2px solid #3b82f6',
                borderRadius: '8px',
                padding: '12px',
                marginBottom: '16px'
              }}>
                <div style={{ fontSize: '12px', color: '#1e40af' }}>
                  <strong>ğŸ’¡ ×”×¡×‘×¨:</strong> ×”×ª×—×•× ×”×—×“×© ×™×¦×™×’ ××ª ×›×œ ×”××§×•××•×ª ××”×ª×—×•× ×”×‘×¡×™×¡. ×œ×“×•×’××”: "×‘×ª×™ ×§×•×œ× ×•×¢" ××‘×•×¡×¡ ×¢×œ "×‘×™×“×•×¨" - ×™×¨××” ××ª ×›×œ ××§×•××•×ª ×”×‘×™×“×•×¨ ××‘×œ ×¢× ×”×©× "×‘×ª×™ ×§×•×œ× ×•×¢"
                </div>
              </div>

              <div className="flex gap-2">
                <button
                  onClick={addCustomInterest}
                  disabled={!newInterest.label.trim() || !newInterest.baseCategory}
                  style={{
                    flex: 1,
                    backgroundColor: (newInterest.label.trim() && newInterest.baseCategory) ? '#8b5cf6' : '#d1d5db',
                    color: 'white',
                    padding: '12px',
                    borderRadius: '8px',
                    fontWeight: 'bold',
                    border: 'none',
                    opacity: (newInterest.label.trim() && newInterest.baseCategory) ? 1 : 0.5
                  }}
                >
                  âœ“ ×”×•×¡×£
                </button>
                <button
                  onClick={() => {
                    setShowAddInterestDialog(false);
                    setNewInterest({ label: '', icon: 'ğŸ“', baseCategory: '' });
                  }}
                  style={{
                    flex: 1,
                    backgroundColor: '#e5e7eb',
                    color: '#374151',
                    padding: '12px',
                    borderRadius: '8px',
                    fontWeight: 'bold',
                    border: 'none'
                  }}
                >
                  ×‘×™×˜×•×œ
                </button>
              </div>
            </div>
          </div>
        )}
      </div>
      
      {/* Import Confirmation Dialog */}
      {showImportDialog && importedData && (
        <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl max-w-md w-full shadow-2xl">
            {/* Header */}
            <div className="sticky top-0 bg-gradient-to-r from-blue-500 to-indigo-500 text-white p-4 rounded-t-2xl">
              <h3 className="text-xl font-bold">ğŸ“¥ ×™×™×‘×•× × ×ª×•× ×™×</h3>
            </div>
            
            {/* Content */}
            <div className="p-6 space-y-4">
              {/* Current State */}
              <div className="bg-gray-100 border-2 border-gray-300 rounded-lg p-4">
                <div className="font-bold text-gray-800 mb-2">ğŸ“Š ××¦×‘ × ×•×›×—×™ ×‘××¤×œ×™×§×¦×™×”:</div>
                <div className="text-sm text-gray-700 space-y-1">
                  <div>â€¢ {customInterests.length} ×ª×—×•××™ ×¢× ×™×™×Ÿ ××•×ª×××™×</div>
                  <div>â€¢ {customLocations.length} ××§×•××•×ª ××•×ª×××™×</div>
                </div>
              </div>
              
              {/* Import File Data */}
              <div className="bg-blue-100 border-2 border-blue-300 rounded-lg p-4">
                <div className="font-bold text-blue-800 mb-2">ğŸ“¥ ×‘×§×•×‘×¥ ×œ×™×™×‘×•×:</div>
                <div className="text-sm text-blue-700 space-y-1">
                  <div>â€¢ {importedData.customInterests?.length || 0} ×ª×—×•××™ ×¢× ×™×™×Ÿ</div>
                  <div>â€¢ {importedData.customLocations?.length || 0} ××§×•××•×ª</div>
                </div>
              </div>
              
              <div className="border-t-2 border-gray-300 my-3"></div>
              
              {/* Info */}
              <div className="bg-green-50 border-2 border-green-300 rounded-lg p-4">
                <div className="text-sm text-green-800">
                  <div className="font-bold mb-2">ğŸ’¡ ××™×š ×”×™×™×‘×•× ×¢×•×‘×“:</div>
                  <ul className="space-y-1 mr-4">
                    <li>â€¢ <strong>×¤×¨×™×˜×™× ×—×“×©×™× ×™×ª×•×•×¡×¤×•</strong></li>
                    <li>â€¢ ×¤×¨×™×˜×™× ×§×™×™××™× ×œ× ×™×©×ª× ×• (×™×“×œ×’×•)</li>
                    <li>â€¢ <strong>×©×•× ×“×‘×¨ ×œ× ×™×™××—×§</strong></li>
                  </ul>
                </div>
              </div>
              
              {/* Buttons */}
              <div className="flex gap-3 pt-2">
                <button
                  onClick={handleImportMerge}
                  className="flex-1 bg-blue-500 text-white py-3 px-4 rounded-lg font-bold hover:bg-blue-600 transition"
                >
                  âœ“ ×”××©×š ×™×™×‘×•×
                </button>
                <button
                  onClick={() => {
                    setShowImportDialog(false);
                    setImportedData(null);
                  }}
                  className="flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-bold hover:bg-gray-400 transition"
                >
                  âœ• ×‘×˜×œ
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
      
      {/* Location Detail Modal - Full details for custom locations */}
      {showLocationDetailModal && selectedLocation && (
        <div 
          className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4"
          onClick={() => {
            setShowLocationDetailModal(false);
            setSelectedLocation(null);
          }}
        >
          <div 
            className="bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl"
            onClick={(e) => e.stopPropagation()}
          >
            {/* Header */}
            <div className="sticky top-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-t-2xl flex justify-between items-center">
              <h3 className="text-xl font-bold">ğŸ“ ×¤×¨×˜×™ ×”××§×•×</h3>
              <button
                onClick={() => {
                  setShowLocationDetailModal(false);
                  setSelectedLocation(null);
                }}
                className="bg-white text-purple-600 rounded-full w-8 h-8 font-bold hover:bg-gray-100"
              >
                âœ•
              </button>
            </div>
            
            {/* Content */}
            <div className="p-4 space-y-4">
              {/* Image */}
              {selectedLocation.uploadedImage && (
                <div className="relative">
                  <img 
                    src={selectedLocation.uploadedImage} 
                    alt={selectedLocation.name}
                    className="w-full h-64 object-cover rounded-xl cursor-pointer hover:opacity-90 transition"
                    onClick={() => {
                      setModalImage(selectedLocation.uploadedImage);
                      setShowImageModal(true);
                    }}
                  />
                  <div className="absolute bottom-2 right-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded">
                    ğŸ‘† ×œ×—×¥ ×œ×”×’×“×œ×”
                  </div>
                </div>
              )}
              
              {/* Image URLs */}
              {selectedLocation.imageUrls && selectedLocation.imageUrls.length > 0 && (
                <div className="grid grid-cols-2 gap-2">
                  {selectedLocation.imageUrls.filter(url => url).map((url, idx) => (
                    <a 
                      key={idx}
                      href={url}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="text-blue-500 text-xs hover:underline truncate"
                    >
                      ğŸ”— ×ª××•× ×” {idx + 1}
                    </a>
                  ))}
                </div>
              )}
              
              {/* Name */}
              <div>
                <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                  {selectedLocation.name}
                  {selectedLocation.outsideArea && (
                    <span className="text-orange-500 text-lg" title="××—×•×¥ ×œ×’×‘×•×œ×•×ª ×”××–×•×¨">ğŸ”º</span>
                  )}
                </h2>
              </div>
              
              {/* Description */}
              {selectedLocation.description && (
                <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-3">
                  <div className="text-xs font-bold text-blue-900 mb-1">ğŸ“ ×ª×™××•×¨:</div>
                  <div className="text-sm text-gray-700">{selectedLocation.description}</div>
                </div>
              )}
              
              {/* Notes */}
              {selectedLocation.notes && (
                <div className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-3">
                  <div className="text-xs font-bold text-yellow-900 mb-1">ğŸ’­ ×”×¢×¨×•×ª ×¤×¨×˜×™×•×ª:</div>
                  <div className="text-sm text-gray-700 italic">{selectedLocation.notes}</div>
                </div>
              )}
              
              {/* Area */}
              <div className="flex items-center gap-2 text-sm">
                <span className="font-bold text-gray-700">ğŸ—ºï¸ ××™×–×•×¨:</span>
                <span className="bg-gray-200 px-3 py-1 rounded-full">
                  {areaOptions.find(a => a.id === selectedLocation.area)?.label || selectedLocation.area}
                </span>
              </div>
              
              {/* Interests Tags */}
              {selectedLocation.interests && selectedLocation.interests.length > 0 && (
                <div>
                  <div className="text-xs font-bold text-gray-700 mb-2">ğŸ·ï¸ ×ª×—×•××™ ×¢× ×™×™×Ÿ:</div>
                  <div className="flex flex-wrap gap-2">
                    {selectedLocation.interests.map(intId => {
                      const interest = allInterestOptions.find(opt => opt.id === intId);
                      return interest ? (
                        <span key={intId} className="bg-purple-100 text-purple-800 text-xs px-3 py-1 rounded-full font-bold">
                          {interest.icon} {interest.label}
                        </span>
                      ) : null;
                    })}
                  </div>
                </div>
              )}
              
              {/* Location */}
              {selectedLocation.lat && selectedLocation.lng && (
                <div className="bg-green-50 border-2 border-green-200 rounded-lg p-3">
                  <div className="text-xs font-bold text-green-900 mb-2">ğŸ“ ××™×§×•×:</div>
                  <div className="text-xs text-gray-600 mb-2 font-mono">
                    {selectedLocation.lat.toFixed(6)}, {selectedLocation.lng.toFixed(6)}
                  </div>
                  <a
                    href={`https://www.google.com/maps/search/${encodeURIComponent(selectedLocation.name)}/@${selectedLocation.lat},${selectedLocation.lng},17z`}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="block w-full bg-green-500 text-white text-center py-2 rounded-lg font-bold hover:bg-green-600 transition"
                  >
                    ğŸ—ºï¸ ×¤×ª×— ×‘-Google Maps
                  </a>
                </div>
              )}
            </div>
            
            {/* Footer Actions */}
            <div className="sticky bottom-0 bg-gray-50 p-4 rounded-b-2xl border-t-2 border-gray-200">
              <div className="flex gap-2">
                <button
                  onClick={() => {
                    setEditingLocation(selectedLocation);
                    setNewLocation(selectedLocation);
                    setShowEditLocationDialog(true);
                    setShowLocationDetailModal(false);
                  }}
                  className="flex-1 bg-blue-500 text-white py-3 rounded-lg font-bold hover:bg-blue-600 transition"
                >
                  âœï¸ ×¢×¨×•×š ××§×•×
                </button>
                <button
                  onClick={() => {
                    setShowLocationDetailModal(false);
                    setSelectedLocation(null);
                  }}
                  className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition"
                >
                  âœ• ×¡×’×•×¨
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
      
      {/* Image Modal - Full screen image view */}
      {showImageModal && modalImage && (
        <div 
          className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50"
          onClick={() => {
            setShowImageModal(false);
            setModalImage(null);
          }}
        >
          <div className="relative max-w-4xl max-h-screen p-4">
            <button
              onClick={(e) => {
                e.stopPropagation();
                setShowImageModal(false);
                setModalImage(null);
              }}
              className="absolute top-6 right-6 bg-white text-black rounded-full w-12 h-12 text-2xl font-bold z-10 shadow-lg hover:bg-gray-200"
            >
              âœ•
            </button>
            <img 
              src={modalImage} 
              alt="Full view"
              className="max-w-full max-h-screen object-contain rounded-lg"
              onClick={(e) => e.stopPropagation()}
            />
          </div>
        </div>
      )}
      
      {/* Toast Notification */}
      {toastMessage && (
        <div
          style={{
            position: 'fixed',
            bottom: '20px',
            right: '20px',
            left: '20px',
            maxWidth: '400px',
            margin: '0 auto',
            padding: '16px',
            borderRadius: '12px',
            backgroundColor: toastMessage.type === 'error' ? '#fee2e2' : toastMessage.type === 'warning' ? '#fef3c7' : '#d1fae5',
            border: `3px solid ${toastMessage.type === 'error' ? '#ef4444' : toastMessage.type === 'warning' ? '#f59e0b' : '#10b981'}`,
            boxShadow: '0 10px 25px rgba(0,0,0,0.3)',
            zIndex: 9999,
            animation: 'slideUp 0.3s ease-out'
          }}
        >
          <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
            <span style={{ fontSize: '24px' }}>
              {toastMessage.type === 'error' ? 'âŒ' : toastMessage.type === 'warning' ? 'âš ï¸' : 'âœ…'}
            </span>
            <div style={{ flex: 1, fontWeight: 'bold', color: '#1f2937' }}>
              {toastMessage.message}
            </div>
            <button
              onClick={() => setToastMessage(null)}
              style={{
                backgroundColor: 'transparent',
                border: 'none',
                fontSize: '20px',
                cursor: 'pointer',
                padding: '0',
                lineHeight: '1'
              }}
            >
              âœ•
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

ReactDOM.createRoot(document.getElementById('root')).render(<BangkokExplorer />);
    </script>
</body>
</html>
v2.0 - [static vs dynamic]
